import{Q as Jn,I as _t,R as De,S as Zn,J as oe,s as q,r as $,u as ee,v as te,w as ne,z,L as ce,F as P,o as Pe,a as me,e as ae,c as ge,i as I,d as N,C as pe,B as J,D as Ce,K as $n,t as es,f as mn,g as gn,h as _n,j as ts,T as ns,p as bn,y as V,U as ss,P as Rt,V as rs,l as Te,m as Ee,n as Ve,G as is,W as os,E as Je,M as de}from"./scheduler.92454ee1.js";import{g as le,t as w,c as ue,a as E,S as Y,i as Q,b as k,d as D,m as F,e as H,f as as}from"./index.e18f9c40.js";import{w as Z,d as An,r as cs}from"./index.5dfebd80.js";import{af as yn,bu as ls,bv as us,b7 as Tn,bw as ds,bx as fs,ao as hs,bs as ps,bq as Mt,b9 as ms,T as gs,aq as _s,ar as ct,as as En,L as bs,P as lt,F as Sn,h as Se,W as As,X as ys,Y as Ts,Z as xe,f as Oe,_ as _e,$ as bt,M as Me,V as G,a0 as wn,O as qe,J as Es,a1 as Ss,B as Ze,a2 as ws,l as xn,m as vn,a3 as ut,a5 as xs,a6 as $e,a7 as vs,e as At,a8 as Rs,a9 as Ms,c as Ls,aa as Ns,b as yt,ab as Cs,ac as Os,ad as Is,ae as Ps,G as et,ag as Rn,ah as ks,ai as Ds,ak as Fs,al as Hs,aj as Mn,Q as Ln,at as js,au as Us,av as Bs,aw as Gs,ax as zs,ay as Vs,az as Ks,aA as Xs,aB as Ae,a4 as Lt,aC as Nt,aE as Ct,aD as Ot,aF as Ye,aG as Tt,aI as Ws,aJ as Nn,d as qs,D as Ys,by as Ue,bz as Be,bA as Cn,an as Qs,bB as Js,a$ as It,bC as dt,bD as Zs,aO as Qe,bE as $s}from"./three.module.445e1080.js";import{e as Pt,u as er,o as tr}from"./each.258ac6aa.js";function kt(i,e){const n=e.token={};function t(s,r,o,c){if(e.token!==n)return;e.resolved=c;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=c);const l=s&&(e.current=s)(a);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,f)=>{f!==r&&d&&(le(),w(d,1,1,()=>{e.blocks[f]===d&&(e.blocks[f]=null)}),ue())}):e.block.d(1),l.c(),E(l,1),l.m(e.mount(),e.anchor),u=!0),e.block=l,e.blocks&&(e.blocks[r]=l),u&&Zn()}if(Jn(i)){const s=_t();if(i.then(r=>{De(s),t(e.then,1,e.value,r),De(null)},r=>{if(De(s),t(e.catch,2,e.error,r),De(null),!e.hasCatch)throw r}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,i),!0;e.resolved=i}}function nr(i,e,n){const t=e.slice(),{resolved:s}=i;i.current===i.then&&(t[i.value]=s),i.current===i.catch&&(t[i.error]=s),i.block.p(t,n)}function Et(i,e){const n={},t={},s={$$scope:1};let r=i.length;for(;r--;){const o=i[r],c=e[r];if(c){for(const a in o)a in c||(t[a]=1);for(const a in c)s[a]||(n[a]=c[a],s[a]=1);i[r]=c}else for(const a in o)s[a]=1}for(const o in t)o in n||(n[o]=void 0);return n}function On(i){return typeof i=="object"&&i!==null?i:{}}const sr=()=>oe("threlte-internal-context");function rr(i){let e;const n=i[9].default,t=$(n,i,i[8],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,[r]){t&&t.p&&(!e||r&256)&&ee(t,n,s,s[8],e?ne(n,s[8],r,null):te(s[8]),null)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}const Dt="threlte-disposable-object-context";function ir(i,e,n){let t,s,{$$slots:r={},$$scope:o}=e;const{collectDisposableObjects:c,addDisposableObjects:a,removeDisposableObjects:l}=sr();let{object:u=void 0}=e,d=u,{dispose:f=void 0}=e;const h=oe(Dt);z(i,h,_=>n(7,s=_));const m=Z(f??s??!0);z(i,m,_=>n(6,t=_)),ce(Dt,m);let p=t?c(u):[];return a(p),P(()=>{l(p)}),i.$$set=_=>{"object"in _&&n(2,u=_.object),"dispose"in _&&n(3,f=_.dispose),"$$scope"in _&&n(8,o=_.$$scope)},i.$$.update=()=>{i.$$.dirty&136&&m.set(f??s??!0),i.$$.dirty&116&&u!==d&&(l(p),n(5,p=t?c(u):[]),a(p),n(4,d=u))},[h,m,u,f,d,p,t,s,o,r]}class or extends Y{constructor(e){super(),Q(this,e,ir,rr,q,{object:2,dispose:3})}}function ar(i,e){const n=Z(i);let t=i;const s=n.subscribe(c=>t=c);return P(s),{...n,set:c=>{if((c==null?void 0:c.uuid)===(t==null?void 0:t.uuid))return;const a=t;n.set(c),e==null||e(c,a)},update:c=>{const a=c(t);if((a==null?void 0:a.uuid)===(t==null?void 0:t.uuid))return;const l=t;n.set(a),e==null||e(a,l)}}}const we=()=>{const i=oe("threlte");if(i===void 0)throw new Error("No Threlte context found, are you using this hook inside of <Canvas>?");return i},cr=()=>oe("threlte-hierarchical-parent-context");function lr(i){let e;const n=i[8].default,t=$(n,i,i[7],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,[r]){t&&t.p&&(!e||r&128)&&ee(t,n,s,s[7],e?ne(n,s[7],r,null):te(s[7]),null)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}const ur=()=>({onChildMount:oe("threlte-hierarchical-object-on-mount"),onChildDestroy:oe("threlte-hierarchical-object-on-destroy")});function dr(i,e,n){var T;let t,{$$slots:s={},$$scope:r}=e,{object:o=void 0}=e,{children:c=[]}=e,{onChildMount:a=void 0}=e;const l=g=>{c.push(g),n(1,c),a==null||a(g)};let{onChildDestroy:u=void 0}=e;const d=g=>{const b=c.findIndex(A=>A.uuid===g.uuid);b!==-1&&c.splice(b,1),n(1,c),u==null||u(g)},{invalidate:f}=we(),h=cr();z(i,h,g=>n(6,t=g));let{parent:m=t}=e;const p=ur();o&&((T=p.onChildMount)==null||T.call(p,o),f("HierarchicalObject: object added"));const _=ar(o,(g,b)=>{var A,M;b&&((A=p.onChildDestroy)==null||A.call(p,b),f("HierarchicalObject: object added")),g&&((M=p.onChildMount)==null||M.call(p,g),f("HierarchicalObject: object removed"))});return P(()=>{var g;o&&((g=p.onChildDestroy)==null||g.call(p,o),f("HierarchicalObject: object removed"))}),ce("threlte-hierarchical-object-on-mount",l),ce("threlte-hierarchical-object-on-destroy",d),ce("threlte-hierarchical-parent-context",_),i.$$set=g=>{"object"in g&&n(3,o=g.object),"children"in g&&n(1,c=g.children),"onChildMount"in g&&n(4,a=g.onChildMount),"onChildDestroy"in g&&n(5,u=g.onChildDestroy),"parent"in g&&n(2,m=g.parent),"$$scope"in g&&n(7,r=g.$$scope)},i.$$.update=()=>{i.$$.dirty&64&&n(2,m=t),i.$$.dirty&8&&_.set(o)},[h,c,m,o,a,u,t,r,s]}class fr extends Y{constructor(e){super(),Q(this,e,dr,lr,q,{object:3,children:1,onChildMount:4,onChildDestroy:5,parent:2})}}function hr(i){let e;const n=i[1].default,t=$(n,i,i[4],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&16)&&ee(t,n,s,s[4],e?ne(n,s[4],r,null):te(s[4]),null)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function pr(i){let e,n;return e=new fr({props:{object:i[0],onChildMount:i[2],onChildDestroy:i[3],$$slots:{default:[hr]},$$scope:{ctx:i}}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,[s]){const r={};s&1&&(r.object=t[0]),s&1&&(r.onChildMount=t[2]),s&1&&(r.onChildDestroy=t[3]),s&16&&(r.$$scope={dirty:s,ctx:t}),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function mr(i,e,n){let{$$slots:t={},$$scope:s}=e,{object:r}=e;const o=a=>r.add(a),c=a=>r.remove(a);return i.$$set=a=>{"object"in a&&n(0,r=a.object),"$$scope"in a&&n(4,s=a.$$scope)},[r,t,o,c,s]}class gr extends Y{constructor(e){super(),Q(this,e,mr,pr,q,{object:0})}}const In=(i,e)=>{if(e.includes(".")){const n=e.split("."),t=n.pop();for(let s=0;s<n.length;s+=1)i=i[n[s]];return{target:i,key:t}}else return{target:i,key:e}},tt=Symbol("initialValueBeforeAttach"),_r=()=>{const{invalidate:i}=we();let e=!1,n=tt,t,s,r;const o=(a,l,u)=>{if(c(),!u){const d=a;((d==null?void 0:d.isMaterial)||!1)&&(u="material"),((d==null?void 0:d.isBufferGeometry)||(d==null?void 0:d.isGeometry)||!1)&&(u="geometry")}if(u){if(typeof u=="function")t=u(l,a);else{const{target:d,key:f}=In(l,u);n=d[f],d[f]=a,s=d,r=f}e=!0,i()}},c=()=>{e&&(t?(t(),t=void 0):s&&r&&n!==tt&&(s[r]=n,n=tt,s=void 0,r=void 0),e=!1,i())};return P(()=>{c()}),{update:o}},br=i=>i&&i.isCamera,Pn=i=>i&&i.isOrthographicCamera,kn=i=>i&&i.isPerspectiveCamera,Ar=i=>kn(i)||Pn(i),yr=()=>{const{invalidate:i,size:e,camera:n}=we();let t,s;P(()=>{s==null||s()});const r=a=>{t&&(Pn(t)?(t.left=a.width/-2,t.right=a.width/2,t.top=a.height/2,t.bottom=a.height/-2,t.updateProjectionMatrix(),t.updateMatrixWorld(),i()):kn(t)&&(t.aspect=a.width/a.height,t.updateProjectionMatrix(),t.updateMatrixWorld(),i()))};return{update:(a,l)=>{if(s==null||s(),l||!Ar(a)){t=void 0;return}t=a,s=e.subscribe(r)},makeDefaultCamera:(a,l)=>{!br(a)||!l||(n.set(a),i())}}},Le=()=>{const i=_t(),e=(t,s)=>{const r=i.$$.callbacks[t];r&&r.forEach(o=>{o(s)})};return Object.defineProperty(e,"hasEventListener",{value:t=>!!i.$$.callbacks[t],enumerable:!0}),e},Tr=()=>{const i=Le(),e=[];let n,t=!1;const s=()=>{e.forEach(c=>c()),e.length=0,i("create",{ref:n,cleanup:c=>{e.push(c)}})},r=o=>{n=o,t&&s()};return Pe(()=>{s(),t=!0}),P(()=>{e.forEach(o=>o())}),{updateRef:r}},Ft=i=>!!(i!=null&&i.addEventListener),Er=()=>{const i=Le(),e=_t(),n=f=>{f!=null&&f.type&&i(f.type,f)},t=(f,h)=>{Ft(f)&&h.forEach(m=>{f.removeEventListener(m,n)})},s=(f,h)=>{Ft(f)&&h.forEach(m=>{f.addEventListener(m,n)})};let r=[],o;const c=Z([]),a=c.subscribe(f=>{t(o,r),s(o,f),r=f});P(a);const l=Z(),u=l.subscribe(f=>{t(o,r),s(f,r),o=f});return P(u),P(()=>{t(o,r)}),Pe(()=>{c.set(Object.keys(e.$$.callbacks))}),{updateRef:f=>{l.set(f)}}},Sr=i=>{const n=oe("threlte-plugin-context");if(!n)return;const t=Object.values(n).map(l=>l(i)).filter(Boolean),s=t.flatMap(l=>l.pluginProps??[]);let r=[];return P(()=>{r.forEach(l=>l())}),{updateRef:l=>{r.forEach(u=>u()),r=[],t.forEach(u=>{var f;const d=(f=u.onRefChange)==null?void 0:f.call(u,l);d&&r.push(d)})},updateProps:l=>{t.forEach(u=>{var d;(d=u.onPropsChange)==null||d.call(u,l)})},updateRestProps:l=>{t.forEach(u=>{var d;(d=u.onRestPropsChange)==null||d.call(u,l)})},pluginsProps:s}},wr=new Set(["$$scope","$$slots","type","args","attach","instance"]),xr=new Set(["fov","aspect","near","far","left","right","top","bottom","zoom"]),vr=i=>typeof i=="string"||typeof i=="number"||typeof i=="boolean"||typeof i>"u"||i===null,Rr=()=>{const{invalidate:i}=we(),e=new Map,n=(s,r,o,c)=>{var u,d;if(vr(o)){const f=e.get(r);if(f&&f.instance===s&&f.value===o)return;e.set(r,{instance:s,value:o})}const{key:a,target:l}=In(s,r);if(!Array.isArray(o)&&typeof o=="number"&&typeof((u=l[a])==null?void 0:u.setScalar)=="function")l[a].setScalar(o);else if(typeof((d=l[a])==null?void 0:d.set)=="function")Array.isArray(o)?l[a].set(...o):l[a].set(o);else{if(l[a]=o,c.manualCamera)return;xr.has(a)&&(l.isPerspectiveCamera||l.isOrthographicCamera)&&l.updateProjectionMatrix()}};return{updateProps:(s,r,o)=>{var c;for(const a in r)!wr.has(a)&&!((c=o.pluginsProps)!=null&&c.includes(a))&&n(s,a,r[a],o),i()}}},Mr=i=>({ref:i&2}),Ht=i=>({ref:i[1]}),Lr=i=>({ref:i&2}),jt=i=>({ref:i[1]});function Ut(i){let e,n;return e=new or({props:{object:i[1],dispose:i[0]}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,s){const r={};s&2&&(r.object=t[1]),s&1&&(r.dispose=t[0]),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function Nr(i){let e;const n=i[12].default,t=$(n,i,i[13],Ht);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&8194)&&ee(t,n,s,s[13],e?ne(n,s[13],r,Mr):te(s[13]),Ht)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function Cr(i){let e,n;return e=new gr({props:{object:i[1],$$slots:{default:[Or]},$$scope:{ctx:i}}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,s){const r={};s&2&&(r.object=t[1]),s&8194&&(r.$$scope={dirty:s,ctx:t}),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function Or(i){let e;const n=i[12].default,t=$(n,i,i[13],jt);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&8194)&&ee(t,n,s,s[13],e?ne(n,s[13],r,Lr):te(s[13]),jt)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function Ir(i){let e=i[4](i[1]),n,t,s,r,o,c,a=e&&Ut(i);const l=[Cr,Nr],u=[];function d(f,h){return h&2&&(t=null),t==null&&(t=!!f[3](f[1])),t?0:1}return s=d(i,-1),r=u[s]=l[s](i),{c(){a&&a.c(),n=me(),r.c(),o=ae()},l(f){a&&a.l(f),n=ge(f),r.l(f),o=ae()},m(f,h){a&&a.m(f,h),I(f,n,h),u[s].m(f,h),I(f,o,h),c=!0},p(f,[h]){h&2&&(e=f[4](f[1])),e?a?(a.p(f,h),h&2&&E(a,1)):(a=Ut(f),a.c(),E(a,1),a.m(n.parentNode,n)):a&&(le(),w(a,1,1,()=>{a=null}),ue());let m=s;s=d(f,h),s===m?u[s].p(f,h):(le(),w(u[m],1,1,()=>{u[m]=null}),ue(),r=u[s],r?r.p(f,h):(r=u[s]=l[s](f),r.c()),E(r,1),r.m(o.parentNode,o))},i(f){c||(E(a),E(r),c=!0)},o(f){w(a),w(r),c=!1},d(f){f&&(N(n),N(o)),a&&a.d(f),u[s].d(f)}}}function Pr(i,e,n){const t=["is","args","attach","manual","makeDefault","dispose","ref"];let s=pe(e,t),r,{$$slots:o={},$$scope:c}=e,{is:a}=e,{args:l=void 0}=e,{attach:u=void 0}=e,{manual:d=void 0}=e,{makeDefault:f=void 0}=e,{dispose:h=void 0}=e;const m=oe("threlte-hierarchical-parent-context");z(i,m,L=>n(11,r=L));const p=L=>typeof L=="function"&&/^\s*class\s+/.test(L.toString()),_=L=>Array.isArray(L),T=Tr();let g=p(a)&&_(l)?new a(...l):p(a)?new a:a;T.updateRef(g);let b=!1;const A=()=>{if(!b){b=!0;return}n(1,g=p(a)&&_(l)?new a(...l):p(a)?new a:a),T.updateRef(g)};let{ref:M=g}=e;const x=Z(g);ce("threlte-hierarchical-parent-context",x);const R=Sr({ref:g,props:e}),S=(R==null?void 0:R.pluginsProps)??[],y=Rr(),K=yr(),ke=_r(),qn=Er(),Yn=L=>!!L.isObject3D,Qn=L=>L.dispose!==void 0;return i.$$set=L=>{n(27,e=J(J({},e),Ce(L))),n(26,s=pe(e,t)),"is"in L&&n(6,a=L.is),"args"in L&&n(7,l=L.args),"attach"in L&&n(8,u=L.attach),"manual"in L&&n(9,d=L.manual),"makeDefault"in L&&n(10,f=L.makeDefault),"dispose"in L&&n(0,h=L.dispose),"ref"in L&&n(5,M=L.ref),"$$scope"in L&&n(13,c=L.$$scope)},i.$$.update=()=>{i.$$.dirty&192&&A(),i.$$.dirty&2&&n(5,M=g),i.$$.dirty&2&&x.set(g),y.updateProps(g,s,{manualCamera:d,pluginsProps:S}),i.$$.dirty&514&&K.update(g,d),i.$$.dirty&1026&&K.makeDefaultCamera(g,f),i.$$.dirty&2306&&ke.update(g,r,u),i.$$.dirty&2&&qn.updateRef(g),i.$$.dirty&2&&(R==null||R.updateRef(g)),R==null||R.updateProps(e),R==null||R.updateRestProps(s)},e=Ce(e),[h,g,m,Yn,Qn,M,a,l,u,d,f,r,o,c]}let St=class extends Y{constructor(e){super(),Q(this,e,Pr,Ir,q,{is:6,args:7,attach:8,manual:9,makeDefault:10,dispose:0,ref:5})}};const wt=typeof window<"u",kr=()=>{const i=Z({width:0,height:0});if(!wt)return{parentSize:i,parentSizeAction:()=>{}};const e={childList:!0,subtree:!1,attributes:!1};let n;const t=c=>{s.disconnect(),r.disconnect(),s.observe(c),r.observe(c,e)},s=new ResizeObserver(([c])=>{const{contentRect:a}=c;i.update(l=>(l.width=a.width,l.height=a.height,l))}),r=new MutationObserver(c=>{for(const a of c)for(const l of a.removedNodes)if(n===l&&n.parentElement){t(n.parentElement);return}}),o=c=>{n=c,n.parentElement&&t(n.parentElement)};return P(()=>{s.disconnect(),r.disconnect()}),{parentSize:i,parentSizeAction:o}},Bt=(i,e)=>{if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let t=0;t<n;t++)if(i[t]!==e[t])return!1;return!0},Dr=()=>{ce("threlte-cache",[])},Xo=()=>{const i=oe("threlte-cache");if(!i)throw new Error("No cache found. The cache can only be used in a child component to <Canvas>.");return{remember:(t,s)=>{for(const o of i)if(Bt(s,o.keys)){if(o.error)throw o.error;if(o.promise)return o.promise}const r={promise:t(),keys:s,value:void 0};return i.push(r),r.promise.catch(o=>{r.error=o}),r.promise},clear:t=>{const s=i.findIndex(r=>Bt(t,r.keys));s!==-1&&i.splice(s,1)}}},Dn=i=>i.userData,Fr=()=>{const i=new yn(75,0,.1,1e3);return Dn(i).threlteDefaultCamera=!0,i.position.z=5,i.lookAt(0,0,0),i},Hr=i=>{Fn(i.size,e=>{Dn($n(i.camera)).threlteDefaultCamera&&i.camera.update(n=>{const t=n;return t.aspect=e.width/e.height,t.updateProjectionMatrix(),i.invalidate("Default camera: aspect ratio changed"),t})})},Fn=(i,e)=>{const n=An(i,r=>r);let t;const s=n.subscribe(async r=>{t&&t();const o=await e(r);o&&(t=o)});P(()=>{s(),t&&t()})},C=i=>{const e=Z(i),n={set:t=>{n.current=t,e.set(t)},subscribe:e.subscribe,update:t=>{const s=t(n.current);n.current=s,e.set(s)},current:i};return n},jr=i=>{const e={debugFrameloop:i.debugFrameloop,frame:0,frameInvalidated:!0,invalidations:{},manualFrameHandlers:new Set,autoFrameHandlers:new Set,allFrameHandlers:new Set,allFrameHandlersNeedSortCheck:!1,renderHandlers:new Set,renderHandlersNeedSortCheck:!1,advance:!1,dispose:async(o=!1)=>{await es(),!(!e.shouldDispose&&!o)&&(e.disposableObjects.forEach((c,a)=>{var l;(c===0||o)&&((l=a==null?void 0:a.dispose)==null||l.call(a),e.disposableObjects.delete(a))}),e.shouldDispose=!1)},collectDisposableObjects:(o,c)=>{const a=c??[];return o&&(o!=null&&o.dispose&&typeof o.dispose=="function"&&o.type!=="Scene"&&a.push(o),Object.entries(o).forEach(([l,u])=>{if(l==="parent"||l==="children"||typeof u!="object")return;const d=u;d!=null&&d.dispose&&e.collectDisposableObjects(d,a)})),a},addDisposableObjects:o=>{o.forEach(c=>{const a=e.disposableObjects.get(c);a?e.disposableObjects.set(c,a+1):e.disposableObjects.set(c,1)})},removeDisposableObjects:o=>{o.length!==0&&(o.forEach(c=>{const a=e.disposableObjects.get(c);a&&a>0&&e.disposableObjects.set(c,a-1)}),e.shouldDispose=!0)},disposableObjects:new Map,shouldDispose:!1},n={size:An([i.userSize,i.parentSize],([o,c])=>o||c),clock:new ls,camera:C(Fr()),scene:new us,renderer:void 0,invalidate:o=>{e.frameInvalidated=!0,e.debugFrameloop&&o&&(e.invalidations[o]=e.invalidations[o]?e.invalidations[o]+1:1)},advance:()=>{e.advance=!0},colorSpace:C(i.colorSpace),toneMapping:C(i.toneMapping),dpr:C(i.dpr),useLegacyLights:C(i.useLegacyLights),shadows:C(i.shadows),colorManagementEnabled:C(i.colorManagementEnabled),frameloop:C(i.frameloop)},t=C({});return ce("threlte",n),ce("threlte-internal-context",e),ce("threlte-user-context",t),{ctx:n,internalCtx:e,getCtx:()=>n,getInternalCtx:()=>e}},Ur=(i,e,n)=>{if(e.allFrameHandlers.size!==0){if(e.allFrameHandlersNeedSortCheck){const t=Array.from(e.allFrameHandlers);if(t.some(r=>r.order)){const r=t.sort((o,c)=>(o.order??0)>(c.order??0)?1:-1);e.allFrameHandlers.clear(),r.forEach(o=>e.allFrameHandlers.add(o))}e.allFrameHandlersNeedSortCheck=!1}if(e.debugFrameloop){let t=0;e.autoFrameHandlers.forEach(s=>{s.debugFrameloopMessage?e.invalidations[s.debugFrameloopMessage]=s.debugFrameloopMessage in e.invalidations?e.invalidations[s.debugFrameloopMessage]+1:1:++t}),t>0&&(e.invalidations.useFrame=e.autoFrameHandlers.size)}e.allFrameHandlers.forEach(t=>t.fn(i,n))}},Br=(i,e,n)=>{if(e.renderHandlers.size!==0){if(e.renderHandlersNeedSortCheck){const t=Array.from(e.renderHandlers);if(t.some(r=>r.order)){const r=t.sort((o,c)=>(o.order??0)>(c.order??0)?1:-1);e.renderHandlers.clear(),r.forEach(o=>e.renderHandlers.add(o))}e.renderHandlersNeedSortCheck=!1}e.renderHandlers.forEach(t=>t.fn(i,n))}},Gr=i=>{i.debugFrameloop&&(i.frame+=1,console.log(`frame: ${i.frame}${Object.keys(i.invalidations).length>0?", requested by ↴":""}`),Object.keys(i.invalidations).length>0&&console.table(i.invalidations),i.invalidations={})},zr=(i,e)=>i.frameloop.current==="always"||i.frameloop.current==="demand"&&(e.frameInvalidated||e.autoFrameHandlers.size>0)||i.frameloop.current==="never"&&e.advance,Vr=(i,e)=>{i.renderer.setAnimationLoop(()=>{e.dispose();const n=i.clock.getDelta();Ur(i,e,n),zr(i,e)&&(e.renderHandlers.size>0?Br(i,e,n):i.camera.current&&i.renderer.render(i.scene,i.camera.current),Gr(e),e.frameInvalidated=!1,e.advance=!1)})},Kr={srgb:ps,"srgb-linear":Mt,"":Mt},Xr=i=>i.outputColorSpace!==void 0,Wr=i=>{const e=Z(void 0),n=(t,s)=>{i.renderer=new ds({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...s}),e.set(i.renderer)};return Fn([e,i.size,i.toneMapping,i.colorSpace,i.dpr,i.shadows,i.colorManagementEnabled,i.useLegacyLights],([t,s,r,o,c,a,l,u])=>{if(!t)return;if(t.setSize(s.width,s.height),t.setPixelRatio(c),Xr(t))t.outputColorSpace=o;else{const m=Kr[o];m?t.outputEncoding=m:console.warn("No encoding found for colorSpace",o)}t.toneMapping=r,t.shadowMap.enabled=!!a,a&&a!==!0?t.shadowMap.type=a:a===!0&&(t.shadowMap.type=Tn);const d=Number.parseInt(fs.replace("dev","")),f=hs;d>=150?f.enabled=l:f.legacyMode=!l;const h=t;d>=150&&u?h.useLegacyLights=u:d<150&&(h.physicallyCorrectLights=!u)}),{createRenderer:n}};function Gt(i){let e,n;return e=new St({props:{is:i[3].ctx.scene,$$slots:{default:[qr]},$$scope:{ctx:i}}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,s){const r={};s&131072&&(r.$$scope={dirty:s,ctx:t}),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function qr(i){let e;const n=i[15].default,t=$(n,i,i[17],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&131072)&&ee(t,n,s,s[17],e?ne(n,s[17],r,null):te(s[17]),null)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function Yr(i){let e,n,t,s,r=i[1]&&Gt(i);return{c(){e=mn("canvas"),r&&r.c(),this.h()},l(o){e=gn(o,"CANVAS",{class:!0});var c=_n(e);r&&r.l(c),c.forEach(N),this.h()},h(){ts(e,"class","svelte-o3oskp")},m(o,c){I(o,e,c),r&&r.m(e,null),i[16](e),n=!0,t||(s=ns(i[2].call(null,e)),t=!0)},p(o,[c]){o[1]?r?(r.p(o,c),c&2&&E(r,1)):(r=Gt(o),r.c(),E(r,1),r.m(e,null)):r&&(le(),w(r,1,1,()=>{r=null}),ue())},i(o){n||(E(r),n=!0)},o(o){w(r),n=!1},d(o){o&&N(e),r&&r.d(),i[16](null),t=!1,s()}}}const zt=new Set;function Qr(i,e,n){let{$$slots:t={},$$scope:s}=e,{dpr:r=wt?window.devicePixelRatio:1}=e,{toneMapping:o=ms}=e,{colorSpace:c="srgb"}=e,{frameloop:a="demand"}=e,{debugFrameloop:l=!1}=e,{shadows:u=Tn}=e,{size:d=void 0}=e,{rendererParameters:f=void 0}=e,{colorManagementEnabled:h=!0}=e,{useLegacyLights:m=!0}=e,p,_=!1;const T=Z(d),{parentSize:g,parentSizeAction:b}=kr(),A=jr({colorSpace:c,toneMapping:o,dpr:r,userSize:T,parentSize:g,debugFrameloop:l,frameloop:a,shadows:u,colorManagementEnabled:h,useLegacyLights:m});Dr();const M=A.ctx;Hr(M),zt.add(M.invalidate),P(()=>{zt.delete(M.invalidate)});const{createRenderer:x}=Wr(M);Pe(()=>{x(p,f),Vr(A.ctx,A.internalCtx),n(1,_=!0)}),P(()=>{var S;A.internalCtx.dispose(!0),(S=A.ctx.renderer)==null||S.dispose()});function R(S){bn[S?"unshift":"push"](()=>{p=S,n(0,p)})}return i.$$set=S=>{"dpr"in S&&n(4,r=S.dpr),"toneMapping"in S&&n(5,o=S.toneMapping),"colorSpace"in S&&n(6,c=S.colorSpace),"frameloop"in S&&n(7,a=S.frameloop),"debugFrameloop"in S&&n(8,l=S.debugFrameloop),"shadows"in S&&n(9,u=S.shadows),"size"in S&&n(10,d=S.size),"rendererParameters"in S&&n(11,f=S.rendererParameters),"colorManagementEnabled"in S&&n(12,h=S.colorManagementEnabled),"useLegacyLights"in S&&n(13,m=S.useLegacyLights),"$$scope"in S&&n(17,s=S.$$scope)},i.$$.update=()=>{i.$$.dirty&1024&&T.set(d)},[p,_,b,A,r,o,c,a,l,u,d,f,h,m,M,t,R,s]}class Wo extends Y{constructor(e){super(),Q(this,e,Qr,Yr,q,{dpr:4,toneMapping:5,colorSpace:6,frameloop:7,debugFrameloop:8,shadows:9,size:10,rendererParameters:11,colorManagementEnabled:12,useLegacyLights:13,ctx:14})}get ctx(){return this.$$.ctx[14]}}const Hn={},Jr=i=>{Object.assign(Hn,i)},Zr=(i,e)=>{const n=Hn[e]||gs[e];if(!n)throw new Error(`No Three.js module found for ${e}. Did you forget to extend the catalogue?`);return{...i,props:{...i.props,is:n}}},$r=i=>new Proxy(class{},{construct(e,[n]){const t=n;return new St(Zr(t,i))}}),W=new Proxy(class{},{construct(i,[e]){const n=e;return new St(n)},get(i,e){return $r(e)}}),ei=(i,e)=>{if(!wt)return{start:()=>{},stop:()=>{},started:cs(!1)};const n=(e==null?void 0:e.invalidate)??!0,t=oe("threlte-internal-context"),s={fn:i,order:e==null?void 0:e.order,debugFrameloopMessage:e==null?void 0:e.debugFrameloopMessage,invalidate:n},r=Z(!1),o=()=>{n?t.autoFrameHandlers.delete(s):t.manualFrameHandlers.delete(s),t.allFrameHandlers.delete(s),r.set(!1)},c=()=>{n?t.autoFrameHandlers.add(s):t.manualFrameHandlers.add(s),t.allFrameHandlers.add(s),t.allFrameHandlersNeedSortCheck=!0,r.set(!0)};return((e==null?void 0:e.autostart)??!0)&&c(),P(()=>{o()}),{start:c,stop:o,started:{subscribe:r.subscribe}}},Vt=async i=>{if((navigator==null?void 0:navigator.xr)===void 0)return"unsupported";if(location.protocol!=="https:")return"insecure";try{return await navigator.xr.isSessionSupported(i)?"supported":"unsupported"}catch(e){return e.name==="SecurityError"?"blocked":"unsupported"}},Ge=Z(!1),nt=C(!1),ft=C(!1),ve=C(void 0),ht=C(void 0),ti=C(void 0),ni=C(void 0),Ke=C(void 0),si=(i,e)=>{if(!(i===void 0&&e===void 0))return i&&e===void 0?{optionalFeatures:[i]}:i&&e?{...e,optionalFeatures:[...new Set([...e.optionalFeatures??[],i])]}:e},ri=async(i,e,n)=>{const t=ve.current,s=t!==void 0;if(n==="enter"&&s)return t;if(n==="exit"&&!s)return;if(s){await t.end(),ve.set(void 0);return}const r=si(ht.current,e),o=await navigator.xr.requestSession(i,r);if(Ke.current===void 0)throw new Error("An <XR> component was not created when attempting to toggle a session.");return await Ke.current.setSession(o),ve.set(o),o};function ii(i){return{c:V,l:V,m:V,p:V,d:V}}function oi(i){let e,n,t;function s(u,d){if(u[11]==="unsupported")return ui;if(u[11]==="insecure")return li;if(u[11]==="blocked")return ci;if(u[11]==="supported")return ai}let r=s(i),o=r&&r(i),c=[i[4]],a={};for(let u=0;u<c.length;u+=1)a=J(a,c[u]);function l(){return i[8](i[11])}return{c(){e=mn("button"),o&&o.c(),this.h()},l(u){e=gn(u,"BUTTON",{});var d=_n(e);o&&o.l(d),d.forEach(N),this.h()},h(){Rt(e,a)},m(u,d){I(u,e,d),o&&o.m(e,null),e.autofocus&&e.focus(),n||(t=rs(e,"click",l),n=!0)},p(u,d){i=u,r===(r=s(i))&&o?o.p(i,d):(o&&o.d(1),o=r&&r(i),o&&(o.c(),o.m(e,null))),Rt(e,a=Et(c,[d&16&&i[4]]))},d(u){u&&N(e),o&&o.d(),n=!1,t()}}}function ai(i){let e=i[2]?"Exit":"Enter",n,t,s;return{c(){n=Te(e),t=me(),s=Te(i[1])},l(r){n=Ee(r,e),t=ge(r),s=Ee(r,i[1])},m(r,o){I(r,n,o),I(r,t,o),I(r,s,o)},p(r,o){o&4&&e!==(e=r[2]?"Exit":"Enter")&&Ve(n,e),o&2&&Ve(s,r[1])},d(r){r&&(N(n),N(t),N(s))}}}function ci(i){let e,n;return{c(){e=Te(i[1]),n=Te(" blocked")},l(t){e=Ee(t,i[1]),n=Ee(t," blocked")},m(t,s){I(t,e,s),I(t,n,s)},p(t,s){s&2&&Ve(e,t[1])},d(t){t&&(N(e),N(n))}}}function li(i){let e;return{c(){e=Te("HTTPS needed")},l(n){e=Ee(n,"HTTPS needed")},m(n,t){I(n,e,t)},p:V,d(n){n&&N(e)}}}function ui(i){let e,n;return{c(){e=Te(i[1]),n=Te(" unsupported")},l(t){e=Ee(t,i[1]),n=Ee(t," unsupported")},m(t,s){I(t,e,s),I(t,n,s)},p(t,s){s&2&&Ve(e,t[1])},d(t){t&&(N(e),N(n))}}}function di(i){return{c:V,l:V,m:V,p:V,d:V}}function fi(i){let e,n,t={ctx:i,current:null,token:null,hasCatch:!1,pending:di,then:oi,catch:ii,value:11};return kt(n=Vt(i[0]),t),{c(){e=ae(),t.block.c()},l(s){e=ae(),t.block.l(s)},m(s,r){I(s,e,r),t.block.m(s,t.anchor=r),t.mount=()=>e.parentNode,t.anchor=e},p(s,[r]){i=s,t.ctx=i,r&1&&n!==(n=Vt(i[0]))&&kt(n,t)||nr(t,i,r)},i:V,o:V,d(s){s&&N(e),t.block.d(s),t.token=null,t=null}}}function hi(i,e,n){let t;const s=["mode","sessionInit","force","styled"];let r=pe(e,s),o,c;z(i,Ge,p=>n(9,o=p)),z(i,ve,p=>n(2,c=p));let{mode:a}=e,{sessionInit:l}=e,{force:u=void 0}=e,{styled:d=!0}=e;const f=ss(),h=async p=>{if(!o)throw new Error("The <XR> component was not created. This is required to start an XR session.");if(f("click",{state:p}),p==="supported")try{await ri(a,l,u)}catch(_){f("error",_)}},m=p=>h(p);return i.$$set=p=>{e=J(J({},e),Ce(p)),n(4,r=pe(e,s)),"mode"in p&&n(0,a=p.mode),"sessionInit"in p&&n(5,l=p.sessionInit),"force"in p&&n(6,u=p.force),"styled"in p&&n(7,d=p.styled)},i.$$.update=()=>{i.$$.dirty&1&&n(1,t={"immersive-vr":"VR","immersive-ar":"AR",inline:"inline"}[a]),d&&n(4,r.style=`
    position: absolute;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 20px;
    border: 1px solid white;
    background: rgba(0, 0, 0, 0.1);
    color: white;
    outline: none;
    z-index: 99999;
    ${r.style??""}
  `,r)},[a,t,c,h,r,l,u,d,m]}class qo extends Y{constructor(e){super(),Q(this,e,hi,fi,q,{mode:0,sessionInit:5,force:6,styled:7})}}function pi(i){let e,n,t,s;return e=new W.CylinderGeometry({props:{args:[Kt,Kt,.2,16,1,!0]}}),t=new W.ShaderMaterial({props:{transparent:!0,vertexShader:i[0],fragmentShader:i[1]}}),{c(){k(e.$$.fragment),n=me(),k(t.$$.fragment)},l(r){D(e.$$.fragment,r),n=ge(r),D(t.$$.fragment,r)},m(r,o){F(e,r,o),I(r,n,o),F(t,r,o),s=!0},p:V,i(r){s||(E(e.$$.fragment,r),E(t.$$.fragment,r),s=!0)},o(r){w(e.$$.fragment,r),w(t.$$.fragment,r),s=!1},d(r){r&&N(n),H(e,r),H(t,r)}}}function mi(i){let e,n;const t=[i[2],{"rotation.x":-Math.PI/2},{"position.z":-.1}];let s={$$slots:{default:[pi]},$$scope:{ctx:i}};for(let r=0;r<t.length;r+=1)s=J(s,t[r]);return e=new W.Mesh({props:s}),{c(){k(e.$$.fragment)},l(r){D(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,[o]){const c=o&4?Et(t,[o&4&&On(r[2]),o&0&&{"rotation.x":-Math.PI/2},t[2]]):{};o&8&&(c.$$scope={dirty:o,ctx:r}),e.$set(c)},i(r){n||(E(e.$$.fragment,r),n=!0)},o(r){w(e.$$.fragment,r),n=!1},d(r){H(e,r)}}}const Kt=.002;function gi(i,e,n){const t=[];let s=pe(e,t);const r=`
varying vec2 vUv;
void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.); }
`,o=`
varying vec2 vUv;
void main() { gl_FragColor = vec4(1., 1., 1., pow(vUv.y - 1., 2.)); }
`;return i.$$set=c=>{e=J(J({},e),Ce(c)),n(2,s=pe(e,t))},[r,o,s]}class _i extends Y{constructor(e){super(),Q(this,e,gi,mi,q,{})}}const Xe=C(void 0),We=C(void 0),pt=C(void 0),jn=C(void 0),Un=C(void 0);Xe.subscribe(i=>jn.set(i==null?void 0:i.inputSource.gamepad));We.subscribe(i=>Un.set(i==null?void 0:i.inputSource.gamepad));const Yo=i=>{switch(i){case"left":return Xe;case"right":return We;case"none":return pt}},Qo=i=>{switch(i){case"left":return jn;case"right":return Un}},Ie={},Jo=(i,e)=>{const n=Ie[i];if(n===void 0){Ie[i]=[e];return}n.push(e)},Zo=(i,e)=>{const n=Ie[i];n!==void 0&&(n.splice(n.indexOf(e),1),n.length===0&&delete Ie[i])},ze=(i,e)=>{const n=Ie[i];n!==void 0&&n.forEach(t=>t(e))};function Xt(i,e){if(e===_s)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===ct||e===En){let n=i.getIndex();if(n===null){const o=[],c=i.getAttribute("position");if(c!==void 0){for(let a=0;a<c.count;a++)o.push(a);i.setIndex(o),n=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const t=n.count-2,s=[];if(e===ct)for(let o=1;o<=t;o++)s.push(n.getX(0)),s.push(n.getX(o)),s.push(n.getX(o+1));else for(let o=0;o<t;o++)o%2===0?(s.push(n.getX(o)),s.push(n.getX(o+1)),s.push(n.getX(o+2))):(s.push(n.getX(o+2)),s.push(n.getX(o+1)),s.push(n.getX(o)));s.length/3!==t&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=i.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}class Bn extends bs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Ei(n)}),this.register(function(n){return new Ni(n)}),this.register(function(n){return new Ci(n)}),this.register(function(n){return new Oi(n)}),this.register(function(n){return new wi(n)}),this.register(function(n){return new xi(n)}),this.register(function(n){return new vi(n)}),this.register(function(n){return new Ri(n)}),this.register(function(n){return new Ti(n)}),this.register(function(n){return new Mi(n)}),this.register(function(n){return new Si(n)}),this.register(function(n){return new Li(n)}),this.register(function(n){return new Ai(n)}),this.register(function(n){return new Ii(n)}),this.register(function(n){return new Pi(n)})}load(e,n,t,s){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=lt.extractUrlBase(e),this.manager.itemStart(e);const c=function(l){s?s(l):console.error(l),r.manager.itemError(e),r.manager.itemEnd(e)},a=new Sn(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{r.parse(l,o,function(u){n(u),r.manager.itemEnd(e)},c)}catch(u){c(u)}},t,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,t,s){let r;const o={},c={},a=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===Gn){try{o[v.KHR_BINARY_GLTF]=new ki(e)}catch(d){s&&s(d);return}r=JSON.parse(o[v.KHR_BINARY_GLTF].content)}else r=JSON.parse(a.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new qi(r,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](l);c[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){const d=r.extensionsUsed[u],f=r.extensionsRequired||[];switch(d){case v.KHR_MATERIALS_UNLIT:o[d]=new yi;break;case v.KHR_DRACO_MESH_COMPRESSION:o[d]=new Di(r,this.dracoLoader);break;case v.KHR_TEXTURE_TRANSFORM:o[d]=new Fi;break;case v.KHR_MESH_QUANTIZATION:o[d]=new Hi;break;default:f.indexOf(d)>=0&&c[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(o),l.setPlugins(c),l.parse(t,s)}parseAsync(e,n){const t=this;return new Promise(function(s,r){t.parse(e,n,s,r)})}}function bi(){let i={};return{get:function(e){return i[e]},add:function(e,n){i[e]=n},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ai{constructor(e){this.parser=e,this.name=v.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let t=0,s=n.length;t<s;t++){const r=n[t];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const n=this.parser,t="light:"+e;let s=n.cache.get(t);if(s)return s;const r=n.json,a=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let l;const u=new Se(16777215);a.color!==void 0&&u.fromArray(a.color);const d=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Ts(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new ys(u),l.distance=d;break;case"spot":l=new As(u),l.distance=d,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,he(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=n.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),n.cache.add(t,s),s}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,t=this.parser,r=t.json.nodes[e],c=(r.extensions&&r.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(a){return t._getNodeRef(n.cache,c,a)})}}class yi{constructor(){this.name=v.KHR_MATERIALS_UNLIT}getMaterialType(){return xe}extendParams(e,n,t){const s=[];e.color=new Se(1,1,1),e.opacity=1;const r=n.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(t.assignTexture(e,"map",r.baseColorTexture,Oe))}return Promise.all(s)}}class Ti{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(n.emissiveIntensity=r),Promise.resolve()}}class Ei{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(n.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(t.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(t.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(t.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const c=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new bt(c,c)}return Promise.all(r)}}class Si{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(n.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(t.assignTexture(n,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(n.iridescenceIOR=o.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(t.assignTexture(n,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class wi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];n.sheenColor=new Se(0,0,0),n.sheenRoughness=0,n.sheen=1;const o=s.extensions[this.name];return o.sheenColorFactor!==void 0&&n.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(t.assignTexture(n,"sheenColorMap",o.sheenColorTexture,Oe)),o.sheenRoughnessTexture!==void 0&&r.push(t.assignTexture(n,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class xi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(n.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(t.assignTexture(n,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class vi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];n.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(t.assignTexture(n,"thicknessMap",o.thicknessTexture)),n.attenuationDistance=o.attenuationDistance||1/0;const c=o.attenuationColor||[1,1,1];return n.attenuationColor=new Se(c[0],c[1],c[2]),Promise.all(r)}}class Ri{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return n.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class Mi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];n.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(t.assignTexture(n,"specularIntensityMap",o.specularTexture));const c=o.specularColorFactor||[1,1,1];return n.specularColor=new Se(c[0],c[1],c[2]),o.specularColorTexture!==void 0&&r.push(t.assignTexture(n,"specularColorMap",o.specularColorTexture,Oe)),Promise.all(r)}}class Li{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:_e}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(n.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(n.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(t.assignTexture(n,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class Ni{constructor(e){this.parser=e,this.name=v.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,t=n.json,s=t.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=n.options.ktx2Loader;if(!o){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,r.source,o)}}class Ci{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[n])return null;const o=r.extensions[n],c=s.images[o.source];let a=t.textureLoader;if(c.uri){const l=t.options.manager.getHandler(c.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return t.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Oi{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[n])return null;const o=r.extensions[n],c=s.images[o.source];let a=t.textureLoader;if(c.uri){const l=t.options.manager.getHandler(c.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return t.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Ii{constructor(e){this.name=v.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,t=n.bufferViews[e];if(t.extensions&&t.extensions[this.name]){const s=t.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(c){const a=s.byteOffset||0,l=s.byteLength||0,u=s.count,d=s.byteStride,f=new Uint8Array(c,a,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,f,s.mode,s.filter).then(function(h){return h.buffer}):o.ready.then(function(){const h=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(h),u,d,f,s.mode,s.filter),h})})}else return null}}class Pi{constructor(e){this.name=v.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,t=n.nodes[e];if(!t.extensions||!t.extensions[this.name]||t.mesh===void 0)return null;const s=n.meshes[t.mesh];for(const l of s.primitives)if(l.mode!==X.TRIANGLES&&l.mode!==X.TRIANGLE_STRIP&&l.mode!==X.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=t.extensions[this.name].attributes,c=[],a={};for(const l in o)c.push(this.parser.getDependency("accessor",o[l]).then(u=>(a[l]=u,a[l])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(l=>{const u=l.pop(),d=u.isGroup?u.children:[u],f=l[0].count,h=[];for(const m of d){const p=new Me,_=new G,T=new Ln,g=new G(1,1,1),b=new wn(m.geometry,m.material,f);for(let A=0;A<f;A++)a.TRANSLATION&&_.fromBufferAttribute(a.TRANSLATION,A),a.ROTATION&&T.fromBufferAttribute(a.ROTATION,A),a.SCALE&&g.fromBufferAttribute(a.SCALE,A),b.setMatrixAt(A,p.compose(_,T,g));for(const A in a)A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&m.geometry.setAttribute(A,a[A]);qe.prototype.copy.call(b,m),this.parser.assignFinalMaterial(b),h.push(b)}return u.isGroup?(u.clear(),u.add(...h),u):h[0]}))}}const Gn="glTF",Ne=12,Wt={JSON:1313821514,BIN:5130562};class ki{constructor(e){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Ne),t=new TextDecoder;if(this.header={magic:t.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Gn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Ne,r=new DataView(e,Ne);let o=0;for(;o<s;){const c=r.getUint32(o,!0);o+=4;const a=r.getUint32(o,!0);if(o+=4,a===Wt.JSON){const l=new Uint8Array(e,Ne+o,c);this.content=t.decode(l)}else if(a===Wt.BIN){const l=Ne+o;this.body=e.slice(l,l+c)}o+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Di{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const t=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,c={},a={},l={};for(const u in o){const d=mt[u]||u.toLowerCase();c[d]=o[u]}for(const u in e.attributes){const d=mt[u]||u.toLowerCase();if(o[u]!==void 0){const f=t.accessors[e.attributes[u]],h=Re[f.componentType];l[d]=h.name,a[d]=f.normalized===!0}}return n.getDependency("bufferView",r).then(function(u){return new Promise(function(d){s.decodeDracoFile(u,function(f){for(const h in f.attributes){const m=f.attributes[h],p=a[h];p!==void 0&&(m.normalized=p)}d(f)},c,l)})})}}class Fi{constructor(){this.name=v.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class Hi{constructor(){this.name=v.KHR_MESH_QUANTIZATION}}class zn extends Ws{constructor(e,n,t,s){super(e,n,t,s)}copySampleValue_(e){const n=this.resultBuffer,t=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)n[o]=t[r+o];return n}interpolate_(e,n,t,s){const r=this.resultBuffer,o=this.sampleValues,c=this.valueSize,a=c*2,l=c*3,u=s-n,d=(t-n)/u,f=d*d,h=f*d,m=e*l,p=m-l,_=-2*h+3*f,T=h-f,g=1-_,b=T-f+d;for(let A=0;A!==c;A++){const M=o[p+A+c],x=o[p+A+a]*u,R=o[m+A+c],S=o[m+A]*u;r[A]=g*M+b*x+_*R+T*S}return r}}const ji=new Ln;class Ui extends zn{interpolate_(e,n,t,s){const r=super.interpolate_(e,n,t,s);return ji.fromArray(r).normalize().toArray(r),r}}const X={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Re={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qt={9728:js,9729:xn,9984:Us,9985:Bs,9986:Gs,9987:vn},Yt={33071:zs,33648:Vs,10497:ut},st={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Bi={CUBICSPLINE:void 0,LINEAR:Mn,STEP:Ks},rt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Gi(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new At({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Xs})),i.DefaultMaterial}function be(i,e,n){for(const t in n.extensions)i[t]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[t]=n.extensions[t])}function he(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function zi(i,e,n){let t=!1,s=!1,r=!1;for(let l=0,u=e.length;l<u;l++){const d=e[l];if(d.POSITION!==void 0&&(t=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(r=!0),t&&s&&r)break}if(!t&&!s&&!r)return Promise.resolve(i);const o=[],c=[],a=[];for(let l=0,u=e.length;l<u;l++){const d=e[l];if(t){const f=d.POSITION!==void 0?n.getDependency("accessor",d.POSITION):i.attributes.position;o.push(f)}if(s){const f=d.NORMAL!==void 0?n.getDependency("accessor",d.NORMAL):i.attributes.normal;c.push(f)}if(r){const f=d.COLOR_0!==void 0?n.getDependency("accessor",d.COLOR_0):i.attributes.color;a.push(f)}}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(a)]).then(function(l){const u=l[0],d=l[1],f=l[2];return t&&(i.morphAttributes.position=u),s&&(i.morphAttributes.normal=d),r&&(i.morphAttributes.color=f),i.morphTargetsRelative=!0,i})}function Vi(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let n=0,t=e.weights.length;n<t;n++)i.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(i.morphTargetInfluences.length===n.length){i.morphTargetDictionary={};for(let t=0,s=n.length;t<s;t++)i.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ki(i){let e;const n=i.extensions&&i.extensions[v.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+it(n.attributes):e=i.indices+":"+it(i.attributes)+":"+i.mode,i.targets!==void 0)for(let t=0,s=i.targets.length;t<s;t++)e+=":"+it(i.targets[t]);return e}function it(i){let e="";const n=Object.keys(i).sort();for(let t=0,s=n.length;t<s;t++)e+=n[t]+":"+i[n[t]]+";";return e}function gt(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Xi(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Wi=new Me;class qi{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new bi,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,s=!1,r=-1;typeof navigator<"u"&&(t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||t||s&&r<98?this.textureLoader=new Es(this.options.manager):this.textureLoader=new Ss(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Sn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const t=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(o){const c={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:t,userData:{}};be(r,c,s),he(c,s),Promise.all(t._invokeAll(function(a){return a.afterRoot&&a.afterRoot(c)})).then(function(){e(c)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[];for(let s=0,r=n.length;s<r;s++){const o=n[s].joints;for(let c=0,a=o.length;c<a;c++)e[o[c]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(t[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,t){if(e.refs[n]<=1)return t;const s=t.clone(),r=(o,c)=>{const a=this.associations.get(o);a!=null&&this.associations.set(c,a);for(const[l,u]of o.children.entries())r(u,c.children[l])};return r(t,s),s.name+="_instance_"+e.uses[n]++,s}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){const s=e(n[t]);if(s)return s}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const t=[];for(let s=0;s<n.length;s++){const r=e(n[s]);r&&t.push(r)}return t}getDependency(e,n){const t=e+":"+n;let s=this.cache.get(t);if(!s){switch(e){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(n)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,n)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(t,s)}return s}getDependencies(e){let n=this.cache.get(e);if(!n){const t=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(r,o){return t.getDependency(e,o)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],t=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){t.load(lt.resolveURL(n.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(t){const s=n.byteLength||0,r=n.byteOffset||0;return t.slice(r,r+s)})}loadAccessor(e){const n=this,t=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=st[s.type],c=Re[s.componentType],a=s.normalized===!0,l=new c(s.count*o);return Promise.resolve(new Ze(l,o,a))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const c=o[0],a=st[s.type],l=Re[s.componentType],u=l.BYTES_PER_ELEMENT,d=u*a,f=s.byteOffset||0,h=s.bufferView!==void 0?t.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let p,_;if(h&&h!==d){const T=Math.floor(f/h),g="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+T+":"+s.count;let b=n.cache.get(g);b||(p=new l(c,T*h,s.count*h/u),b=new ws(p,h/u),n.cache.add(g,b)),_=new Ae(b,a,f%h/u,m)}else c===null?p=new l(s.count*a):p=new l(c,f,s.count*a),_=new Ze(p,a,m);if(s.sparse!==void 0){const T=st.SCALAR,g=Re[s.sparse.indices.componentType],b=s.sparse.indices.byteOffset||0,A=s.sparse.values.byteOffset||0,M=new g(o[1],b,s.sparse.count*T),x=new l(o[2],A,s.sparse.count*a);c!==null&&(_=new Ze(_.array.slice(),_.itemSize,_.normalized));for(let R=0,S=M.length;R<S;R++){const y=M[R];if(_.setX(y,x[R*a]),a>=2&&_.setY(y,x[R*a+1]),a>=3&&_.setZ(y,x[R*a+2]),a>=4&&_.setW(y,x[R*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return _})}loadTexture(e){const n=this.json,t=this.options,r=n.textures[e].source,o=n.images[r];let c=this.textureLoader;if(o.uri){const a=t.manager.getHandler(o.uri);a!==null&&(c=a)}return this.loadTextureImage(e,r,c)}loadTextureImage(e,n,t){const s=this,r=this.json,o=r.textures[e],c=r.images[n],a=(c.uri||c.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(n,t).then(function(u){u.flipY=!1,u.name=o.name||c.name||"",u.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(u.name=c.uri);const f=(r.samplers||{})[o.sampler]||{};return u.magFilter=qt[f.magFilter]||xn,u.minFilter=qt[f.minFilter]||vn,u.wrapS=Yt[f.wrapS]||ut,u.wrapT=Yt[f.wrapT]||ut,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,n){const t=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=s.images[e],c=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(o.bufferView!==void 0)a=t.getDependency("bufferView",o.bufferView).then(function(d){l=!0;const f=new Blob([d],{type:o.mimeType});return a=c.createObjectURL(f),a});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(a).then(function(d){return new Promise(function(f,h){let m=f;n.isImageBitmapLoader===!0&&(m=function(p){const _=new Lt(p);_.needsUpdate=!0,f(_)}),n.load(lt.resolveURL(d,r.path),m,void 0,h)})}).then(function(d){return l===!0&&c.revokeObjectURL(a),d.userData.mimeType=o.mimeType||Xi(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),d});return this.sourceCache[e]=u,u}assignTexture(e,n,t,s){const r=this;return this.getDependency("texture",t.index).then(function(o){if(!o)return null;if(t.texCoord!==void 0&&t.texCoord>0&&(o=o.clone(),o.channel=t.texCoord),r.extensions[v.KHR_TEXTURE_TRANSFORM]){const c=t.extensions!==void 0?t.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const a=r.associations.get(o);o=r.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(o,c),r.associations.set(o,a)}}return s!==void 0&&(o.colorSpace=s),e[n]=o,o})}assignFinalMaterial(e){const n=e.geometry;let t=e.material;const s=n.attributes.tangent===void 0,r=n.attributes.color!==void 0,o=n.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+t.uuid;let a=this.cache.get(c);a||(a=new xs,$e.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,a.sizeAttenuation=!1,this.cache.add(c,a)),t=a}else if(e.isLine){const c="LineBasicMaterial:"+t.uuid;let a=this.cache.get(c);a||(a=new vs,$e.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,this.cache.add(c,a)),t=a}if(s||r||o){let c="ClonedMaterial:"+t.uuid+":";s&&(c+="derivative-tangents:"),r&&(c+="vertex-colors:"),o&&(c+="flat-shading:");let a=this.cache.get(c);a||(a=t.clone(),r&&(a.vertexColors=!0),o&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(c,a),this.associations.set(a,this.associations.get(t))),t=a}e.material=t}getMaterialType(){return At}loadMaterial(e){const n=this,t=this.json,s=this.extensions,r=t.materials[e];let o;const c={},a=r.extensions||{},l=[];if(a[v.KHR_MATERIALS_UNLIT]){const d=s[v.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),l.push(d.extendParams(c,r,n))}else{const d=r.pbrMetallicRoughness||{};if(c.color=new Se(1,1,1),c.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;c.color.fromArray(f),c.opacity=f[3]}d.baseColorTexture!==void 0&&l.push(n.assignTexture(c,"map",d.baseColorTexture,Oe)),c.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,c.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(l.push(n.assignTexture(c,"metalnessMap",d.metallicRoughnessTexture)),l.push(n.assignTexture(c,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,c)})))}r.doubleSided===!0&&(c.side=Rs);const u=r.alphaMode||rt.OPAQUE;if(u===rt.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,u===rt.MASK&&(c.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==xe&&(l.push(n.assignTexture(c,"normalMap",r.normalTexture)),c.normalScale=new bt(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;c.normalScale.set(d,d)}return r.occlusionTexture!==void 0&&o!==xe&&(l.push(n.assignTexture(c,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==xe&&(c.emissive=new Se().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==xe&&l.push(n.assignTexture(c,"emissiveMap",r.emissiveTexture,Oe)),Promise.all(l).then(function(){const d=new o(c);return r.name&&(d.name=r.name),he(d,r),n.associations.set(d,{materials:e}),r.extensions&&be(s,d,r),d})}createUniqueName(e){const n=Ms.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,t=this.extensions,s=this.primitiveCache;function r(c){return t[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,n).then(function(a){return Qt(a,c,n)})}const o=[];for(let c=0,a=e.length;c<a;c++){const l=e[c],u=Ki(l),d=s[u];if(d)o.push(d.promise);else{let f;l.extensions&&l.extensions[v.KHR_DRACO_MESH_COMPRESSION]?f=r(l):f=Qt(new Ls,l,n),s[u]={primitive:l,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const n=this,t=this.json,s=this.extensions,r=t.meshes[e],o=r.primitives,c=[];for(let a=0,l=o.length;a<l;a++){const u=o[a].material===void 0?Gi(this.cache):this.getDependency("material",o[a].material);c.push(u)}return c.push(n.loadGeometries(o)),Promise.all(c).then(function(a){const l=a.slice(0,a.length-1),u=a[a.length-1],d=[];for(let h=0,m=u.length;h<m;h++){const p=u[h],_=o[h];let T;const g=l[h];if(_.mode===X.TRIANGLES||_.mode===X.TRIANGLE_STRIP||_.mode===X.TRIANGLE_FAN||_.mode===void 0)T=r.isSkinnedMesh===!0?new Ns(p,g):new yt(p,g),T.isSkinnedMesh===!0&&T.normalizeSkinWeights(),_.mode===X.TRIANGLE_STRIP?T.geometry=Xt(T.geometry,En):_.mode===X.TRIANGLE_FAN&&(T.geometry=Xt(T.geometry,ct));else if(_.mode===X.LINES)T=new Cs(p,g);else if(_.mode===X.LINE_STRIP)T=new Os(p,g);else if(_.mode===X.LINE_LOOP)T=new Is(p,g);else if(_.mode===X.POINTS)T=new Ps(p,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+_.mode);Object.keys(T.geometry.morphAttributes).length>0&&Vi(T,r),T.name=n.createUniqueName(r.name||"mesh_"+e),he(T,r),_.extensions&&be(s,T,_),n.assignFinalMaterial(T),d.push(T)}for(let h=0,m=d.length;h<m;h++)n.associations.set(d[h],{meshes:e,primitives:h});if(d.length===1)return r.extensions&&be(s,d[0],r),d[0];const f=new et;r.extensions&&be(s,f,r),n.associations.set(f,{meshes:e});for(let h=0,m=d.length;h<m;h++)f.add(d[h]);return f})}loadCamera(e){let n;const t=this.json.cameras[e],s=t[t.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return t.type==="perspective"?n=new yn(Rn.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):t.type==="orthographic"&&(n=new ks(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),t.name&&(n.name=this.createUniqueName(t.name)),he(n,t),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],t=[];for(let s=0,r=n.joints.length;s<r;s++)t.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?t.push(this.getDependency("accessor",n.inverseBindMatrices)):t.push(null),Promise.all(t).then(function(s){const r=s.pop(),o=s,c=[],a=[];for(let l=0,u=o.length;l<u;l++){const d=o[l];if(d){c.push(d);const f=new Me;r!==null&&f.fromArray(r.array,l*16),a.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[l])}return new Ds(c,a)})}loadAnimation(e){const n=this.json,t=this,s=n.animations[e],r=s.name?s.name:"animation_"+e,o=[],c=[],a=[],l=[],u=[];for(let d=0,f=s.channels.length;d<f;d++){const h=s.channels[d],m=s.samplers[h.sampler],p=h.target,_=p.node,T=s.parameters!==void 0?s.parameters[m.input]:m.input,g=s.parameters!==void 0?s.parameters[m.output]:m.output;p.node!==void 0&&(o.push(this.getDependency("node",_)),c.push(this.getDependency("accessor",T)),a.push(this.getDependency("accessor",g)),l.push(m),u.push(p))}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(a),Promise.all(l),Promise.all(u)]).then(function(d){const f=d[0],h=d[1],m=d[2],p=d[3],_=d[4],T=[];for(let g=0,b=f.length;g<b;g++){const A=f[g],M=h[g],x=m[g],R=p[g],S=_[g];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const y=t._createAnimationTracks(A,M,x,R,S);if(y)for(let K=0;K<y.length;K++)T.push(y[K])}return new Fs(r,void 0,T)})}createNodeMesh(e){const n=this.json,t=this,s=n.nodes[e];return s.mesh===void 0?null:t.getDependency("mesh",s.mesh).then(function(r){const o=t._getNodeRef(t.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(c){if(c.isMesh)for(let a=0,l=s.weights.length;a<l;a++)c.morphTargetInfluences[a]=s.weights[a]}),o})}loadNode(e){const n=this.json,t=this,s=n.nodes[e],r=t._loadNodeShallow(e),o=[],c=s.children||[];for(let l=0,u=c.length;l<u;l++)o.push(t.getDependency("node",c[l]));const a=s.skin===void 0?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),a]).then(function(l){const u=l[0],d=l[1],f=l[2];f!==null&&u.traverse(function(h){h.isSkinnedMesh&&h.bind(f,Wi)});for(let h=0,m=d.length;h<m;h++)u.add(d[h]);return u})}_loadNodeShallow(e){const n=this.json,t=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=n.nodes[e],o=r.name?s.createUniqueName(r.name):"",c=[],a=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&c.push(a),r.camera!==void 0&&c.push(s.getDependency("camera",r.camera).then(function(l){return s._getNodeRef(s.cameraCache,r.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){c.push(l)}),this.nodeCache[e]=Promise.all(c).then(function(l){let u;if(r.isBone===!0?u=new Hs:l.length>1?u=new et:l.length===1?u=l[0]:u=new qe,u!==l[0])for(let d=0,f=l.length;d<f;d++)u.add(l[d]);if(r.name&&(u.userData.name=r.name,u.name=o),he(u,r),r.extensions&&be(t,u,r),r.matrix!==void 0){const d=new Me;d.fromArray(r.matrix),u.applyMatrix4(d)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const n=this.extensions,t=this.json.scenes[e],s=this,r=new et;t.name&&(r.name=s.createUniqueName(t.name)),he(r,t),t.extensions&&be(n,r,t);const o=t.nodes||[],c=[];for(let a=0,l=o.length;a<l;a++)c.push(s.getDependency("node",o[a]));return Promise.all(c).then(function(a){for(let u=0,d=a.length;u<d;u++)r.add(a[u]);const l=u=>{const d=new Map;for(const[f,h]of s.associations)(f instanceof $e||f instanceof Lt)&&d.set(f,h);return u.traverse(f=>{const h=s.associations.get(f);h!=null&&d.set(f,h)}),d};return s.associations=l(r),r})}_createAnimationTracks(e,n,t,s,r){const o=[],c=e.name?e.name:e.uuid,a=[];fe[r.path]===fe.weights?e.traverse(function(f){f.morphTargetInfluences&&a.push(f.name?f.name:f.uuid)}):a.push(c);let l;switch(fe[r.path]){case fe.weights:l=Ct;break;case fe.rotation:l=Ot;break;case fe.position:case fe.scale:l=Nt;break;default:switch(t.itemSize){case 1:l=Ct;break;case 2:case 3:default:l=Nt;break}break}const u=s.interpolation!==void 0?Bi[s.interpolation]:Mn,d=this._getArrayFromAccessor(t);for(let f=0,h=a.length;f<h;f++){const m=new l(a[f]+"."+fe[r.path],n.array,d,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const t=gt(n.constructor),s=new Float32Array(n.length);for(let r=0,o=n.length;r<o;r++)s[r]=n[r]*t;n=s}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){const s=this instanceof Ot?Ui:zn;return new s(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Yi(i,e,n){const t=e.attributes,s=new Ye;if(t.POSITION!==void 0){const c=n.json.accessors[t.POSITION],a=c.min,l=c.max;if(a!==void 0&&l!==void 0){if(s.set(new G(a[0],a[1],a[2]),new G(l[0],l[1],l[2])),c.normalized){const u=gt(Re[c.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const c=new G,a=new G;for(let l=0,u=r.length;l<u;l++){const d=r[l];if(d.POSITION!==void 0){const f=n.json.accessors[d.POSITION],h=f.min,m=f.max;if(h!==void 0&&m!==void 0){if(a.setX(Math.max(Math.abs(h[0]),Math.abs(m[0]))),a.setY(Math.max(Math.abs(h[1]),Math.abs(m[1]))),a.setZ(Math.max(Math.abs(h[2]),Math.abs(m[2]))),f.normalized){const p=gt(Re[f.componentType]);a.multiplyScalar(p)}c.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(c)}i.boundingBox=s;const o=new Tt;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=o}function Qt(i,e,n){const t=e.attributes,s=[];function r(o,c){return n.getDependency("accessor",o).then(function(a){i.setAttribute(c,a)})}for(const o in t){const c=mt[o]||o.toLowerCase();c in i.attributes||s.push(r(t[o],c))}if(e.indices!==void 0&&!i.index){const o=n.getDependency("accessor",e.indices).then(function(c){i.setIndex(c)});s.push(o)}return he(i,e),Yi(i,e,n),Promise.all(s).then(function(){return e.targets!==void 0?zi(i,e.targets,n):i})}const O={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Vn(i){const e=await fetch(i);if(e.ok)return e.json();throw new Error(e.statusText)}async function Qi(i){if(!i)throw new Error("No basePath supplied");return await Vn(`${i}/profilesList.json`)}async function Ji(i,e,n=null,t=!0){if(!i)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await Qi(e);let r;if(i.profiles.some(a=>{const l=s[a];return l&&(r={profileId:a,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}),!!r}),!r){if(!n)throw new Error("No matching profile name found");const a=s[n];if(!a)throw new Error(`No matching profile name found and default profile "${n}" missing.`);r={profileId:n,profilePath:`${e}/${a.path}`,deprecated:!!a.deprecated}}const o=await Vn(r.profilePath);let c;if(t){let a;if(i.handedness==="any"?a=o.layouts[Object.keys(o.layouts)[0]]:a=o.layouts[i.handedness],!a)throw new Error(`No matching handedness, ${i.handedness}, in profile ${r.profileId}`);a.assetPath&&(c=r.profilePath.replace("profile.json",a.assetPath))}return{profile:o,assetPath:c}}const Zi={xAxis:0,yAxis:0,button:0,state:O.ComponentState.DEFAULT};function $i(i=0,e=0){let n=i,t=e;if(Math.sqrt(i*i+e*e)>1){const o=Math.atan2(e,i);n=Math.cos(o),t=Math.sin(o)}return{normalizedXAxis:n*.5+.5,normalizedYAxis:t*.5+.5}}class eo{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===O.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Zi)}updateFromComponent({xAxis:e,yAxis:n,button:t,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=$i(e,n);switch(this.componentProperty){case O.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case O.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case O.ComponentProperty.BUTTON:this.value=this.states.includes(s)?t:0;break;case O.ComponentProperty.STATE:this.valueNodeProperty===O.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class to{constructor(e,n){if(!e||!n||!n.visualResponses||!n.gamepadIndices||Object.keys(n.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=n.type,this.rootNodeName=n.rootNodeName,this.touchPointNodeName=n.touchPointNodeName,this.visualResponses={},Object.keys(n.visualResponses).forEach(t=>{const s=new eo(n.visualResponses[t]);this.visualResponses[t]=s}),this.gamepadIndices=Object.assign({},n.gamepadIndices),this.values={state:O.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=O.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const n=e.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||this.values.button===1?this.values.state=O.ComponentState.PRESSED:(n.touched||this.values.button>O.ButtonTouchThreshold)&&(this.values.state=O.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===O.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>O.AxisTouchThreshold&&(this.values.state=O.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===O.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>O.AxisTouchThreshold&&(this.values.state=O.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(n=>{n.updateFromComponent(this.values)})}}class no{constructor(e,n,t){if(!e)throw new Error("No xrInputSource supplied");if(!n)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=t,this.id=n.profileId,this.layoutDescription=n.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new to(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(n=>{e.push(n.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const so="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",ro="generic-trigger";class io extends qe{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(n=>{n.isMesh&&(n.material.envMap=this.envMap,n.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(n=>{Object.values(n.visualResponses).forEach(t=>{const{valueNode:s,minNode:r,maxNode:o,value:c,valueNodeProperty:a}=t;s&&(a===O.VisualResponseProperty.VISIBILITY?s.visible=c:a===O.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(r.quaternion,o.quaternion,c),s.position.lerpVectors(r.position,o.position,c)))})}))}}function oo(i,e){Object.values(i.components).forEach(n=>{const{type:t,touchPointNodeName:s,visualResponses:r}=n;if(t===O.ComponentType.TOUCHPAD)if(n.touchPointNode=e.getObjectByName(s),n.touchPointNode){const o=new Nn(.001),c=new xe({color:255}),a=new yt(o,c);n.touchPointNode.add(a)}else console.warn(`Could not find touch dot, ${n.touchPointNodeName}, in touchpad component ${n.id}`);Object.values(r).forEach(o=>{const{valueNodeName:c,minNodeName:a,maxNodeName:l,valueNodeProperty:u}=o;if(u===O.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(a),o.maxNode=e.getObjectByName(l),!o.minNode){console.warn(`Could not find ${a} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${l} in the model`);return}}o.valueNode=e.getObjectByName(c),o.valueNode||console.warn(`Could not find ${c} in the model`)})})}function Jt(i,e){oo(i.motionController,e),i.envMap&&e.traverse(n=>{n.isMesh&&(n.material.envMap=i.envMap,n.material.needsUpdate=!0)}),i.add(e)}class ao{constructor(e=null){this.gltfLoader=e,this.path=so,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Bn)}createControllerModel(e){const n=new io;let t=null;return e.addEventListener("connected",s=>{const r=s.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||Ji(r,this.path,ro).then(({profile:o,assetPath:c})=>{n.motionController=new no(r,o,c);const a=this._assetCache[n.motionController.assetUrl];if(a)t=a.scene.clone(),Jt(n,t);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(n.motionController.assetUrl,l=>{this._assetCache[n.motionController.assetUrl]=l,t=l.scene.clone(),Jt(n,t)},null,()=>{throw new Error(`Asset ${n.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{n.motionController=null,n.remove(t),t=null}),n}}function Zt(i){let e,n;return e=new W({props:{is:i[3],name:"XR Controller Grip Model "+i[0]}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,s){const r={};s&8&&(r.is=t[3]),s&1&&(r.name="XR Controller Grip Model "+t[0]),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function co(i){let e,n,t=i[1]!=="none"&&Zt(i);const s=i[9].default,r=$(s,i,i[10],null);return{c(){t&&t.c(),e=me(),r&&r.c()},l(o){t&&t.l(o),e=ge(o),r&&r.l(o)},m(o,c){t&&t.m(o,c),I(o,e,c),r&&r.m(o,c),n=!0},p(o,c){o[1]!=="none"?t?(t.p(o,c),c&2&&E(t,1)):(t=Zt(o),t.c(),E(t,1),t.m(e.parentNode,e)):t&&(le(),w(t,1,1,()=>{t=null}),ue()),r&&r.p&&(!n||c&1024)&&ee(r,s,o,o[10],n?ne(s,o[10],c,null):te(o[10]),null)},i(o){n||(E(t),E(r,o),n=!0)},o(o){w(t),w(r,o),n=!1},d(o){o&&N(e),t&&t.d(o),r&&r.d(o)}}}function lo(i){let e,n;return e=new _i({props:{visible:i[5]===i[7]&&i[6]===void 0}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,s){const r={};s&96&&(r.visible=t[5]===t[7]&&t[6]===void 0),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function uo(i){let e,n,t,s;return e=new W({props:{is:i[8],name:"XR Controller Grip "+i[0],visible:i[2]&&!i[4],$$slots:{default:[co]},$$scope:{ctx:i}}}),t=new W({props:{is:i[7],name:"XR Controller "+i[0],visible:i[2]&&!i[4],$$slots:{default:[lo]},$$scope:{ctx:i}}}),{c(){k(e.$$.fragment),n=me(),k(t.$$.fragment)},l(r){D(e.$$.fragment,r),n=ge(r),D(t.$$.fragment,r)},m(r,o){F(e,r,o),I(r,n,o),F(t,r,o),s=!0},p(r,[o]){const c={};o&1&&(c.name="XR Controller Grip "+r[0]),o&20&&(c.visible=r[2]&&!r[4]),o&1035&&(c.$$scope={dirty:o,ctx:r}),e.$set(c);const a={};o&1&&(a.name="XR Controller "+r[0]),o&20&&(a.visible=r[2]&&!r[4]),o&1120&&(a.$$scope={dirty:o,ctx:r}),t.$set(a)},i(r){s||(E(e.$$.fragment,r),E(t.$$.fragment,r),s=!0)},o(r){w(e.$$.fragment,r),w(t.$$.fragment,r),s=!1},d(r){r&&N(n),H(e,r),H(t,r)}}}const fo=new ao,$t=["select","selectstart","selectend","squeeze","squeezeend","squeezestart"];function ho(i,e,n){let t,s,r,o;z(i,ft,b=>n(4,s=b)),z(i,ti,b=>n(5,r=b)),z(i,ni,b=>n(6,o=b));let{$$slots:c={},$$scope:a}=e,{index:l}=e,{model:u=void 0}=e;const d=Le(),{xr:f}=we().renderer,h=f.getController(l),m=f.getControllerGrip(l);let p=!1;const _=b=>{const A=b.data,M={controller:h,grip:m,inputSource:A};switch(n(2,p=!0),ze("connected",b),d("connected",b),A.handedness){case"left":return Xe.set(M);case"right":return We.set(M);case"none":return pt.set(M)}},T=b=>{const A=b.data;switch(n(2,p=!1),ze("disconnected",b),d("disconnected",b),A.handedness){case"left":return Xe.set(void 0);case"right":return We.set(void 0);case"none":return pt.set(void 0)}},g=b=>{ze(b.type,b),d(b.type,b)};return Pe(()=>{h.addEventListener("connected",_),h.addEventListener("disconnected",T),$t.forEach(b=>h.addEventListener(b,g))}),P(()=>{h.removeEventListener("connected",_),h.removeEventListener("disconnected",T),$t.forEach(b=>h.removeEventListener(b,g))}),i.$$set=b=>{"index"in b&&n(0,l=b.index),"model"in b&&n(1,u=b.model),"$$scope"in b&&n(10,a=b.$$scope)},i.$$.update=()=>{i.$$.dirty&2&&n(3,t=u??fo.createControllerModel(m))},[l,u,p,t,s,r,o,h,m,c,a]}class $o extends Y{constructor(e){super(),Q(this,e,ho,uo,q,{index:0,model:1})}}const Kn=C(void 0),Xn=C(void 0),ea=i=>{switch(i){case"left":return Kn;case"right":return Xn}},en=new Me,tn=new G;class nn{constructor(e,n,t,s,r){this.controller=n,this.handModel=e,this.envMap=null;let o;!r||!r.primitive||r.primitive==="sphere"?o=new Nn(1,10,10):r.primitive==="box"&&(o=new qs(1,1,1));const c=new At;this.handMesh=new wn(o,c,30),this.handMesh.frustumCulled=!1,this.handMesh.instanceMatrix.setUsage(Ys),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const n=this.controller.joints;let t=0;for(let s=0;s<this.joints.length;s++){const r=n[this.joints[s]];r.visible&&(tn.setScalar(r.jointRadius||.008),en.compose(r.position,r.quaternion,tn),this.handMesh.setMatrixAt(s,en),t++)}this.handMesh.count=t,this.handMesh.instanceMatrix.needsUpdate=!0}}const po="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class mo{constructor(e,n,t,s,r=null){this.controller=n,this.handModel=e,this.bones=[],r===null&&(r=new Bn,r.setPath(t||po)),r.load(`${s}.glb`,o=>{const c=o.scene.children[0];this.handModel.add(c);const a=c.getObjectByProperty("type","SkinnedMesh");a.frustumCulled=!1,a.castShadow=!0,a.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(u=>{const d=c.getObjectByName(u);d!==void 0?d.jointName=u:console.warn(`Couldn't find ${u} in ${s} hand mesh`),this.bones.push(d)})})}updateMesh(){const e=this.controller.joints;for(let n=0;n<this.bones.length;n++){const t=this.bones[n];if(t){const s=e[t.jointName];if(s.visible){const r=s.position;t.position.copy(r),t.quaternion.copy(s.quaternion)}}}}}class go extends qe{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}}class _o{constructor(){this.path=null}setPath(e){return this.path=e,this}createHandModel(e,n){const t=new go(e);return e.addEventListener("connected",s=>{const r=s.data;r.hand&&!t.motionController&&(t.xrInputSource=r,n===void 0||n==="spheres"?t.motionController=new nn(t,e,this.path,r.handedness,{primitive:"sphere"}):n==="boxes"?t.motionController=new nn(t,e,this.path,r.handedness,{primitive:"box"}):n==="mesh"&&(t.motionController=new mo(t,e,this.path,r.handedness))),e.visible=!0}),e.addEventListener("disconnected",()=>{e.visible=!1}),t}}function sn(i){let e,n;return e=new W({props:{is:i[5],name:"XR Hand Model "+i[0]}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,s){const r={};s&1&&(r.name="XR Hand Model "+t[0]),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function bo(i){let e;const n=i[6].default,t=$(n,i,i[8],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&256)&&ee(t,n,s,s[8],e?ne(n,s[8],r,null):te(s[8]),null)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function Ao(i){let e,n,t,s,r=i[1]!=="none"&&sn(i);function o(a){i[7](a)}let c={$$slots:{default:[bo]},$$scope:{ctx:i}};return i[3]!==void 0&&(c.ref=i[3]),n=new W.Group({props:c}),bn.push(()=>as(n,"ref",o)),{c(){r&&r.c(),e=me(),k(n.$$.fragment)},l(a){r&&r.l(a),e=ge(a),D(n.$$.fragment,a)},m(a,l){r&&r.m(a,l),I(a,e,l),F(n,a,l),s=!0},p(a,l){a[1]!=="none"?r?(r.p(a,l),l&2&&E(r,1)):(r=sn(a),r.c(),E(r,1),r.m(e.parentNode,e)):r&&(le(),w(r,1,1,()=>{r=null}),ue());const u={};l&256&&(u.$$scope={dirty:l,ctx:a}),!t&&l&8&&(t=!0,u.ref=a[3],is(()=>t=!1)),n.$set(u)},i(a){s||(E(r),E(n.$$.fragment,a),s=!0)},o(a){w(r),w(n.$$.fragment,a),s=!1},d(a){a&&N(e),r&&r.d(a),H(n,a)}}}function yo(i){let e,n;return e=new W({props:{is:i[4],name:"XR Hand "+i[0],visible:i[2],$$slots:{default:[Ao]},$$scope:{ctx:i}}}),{c(){k(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,s){F(e,t,s),n=!0},p(t,[s]){const r={};s&1&&(r.name="XR Hand "+t[0]),s&4&&(r.visible=t[2]),s&267&&(r.$$scope={dirty:s,ctx:t}),e.$set(r)},i(t){n||(E(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}const To=new _o;function Eo(i,e,n){let{$$slots:t={},$$scope:s}=e;const r=os(t);let{index:o}=e,{profile:c="mesh"}=e;const a=Le(),{xr:l}=we().renderer,u=l.getHand(o),d=l.getReferenceSpace(),f=To.createHandModel(u,c==="none"?"mesh":c);let h=!1,m,p;const _=x=>{m=x.data.hand,n(2,h=!0),a(x.type,x);const R={hand:u,inputSource:m};switch(x.data.handedness){case"left":return Kn.set(R);case"right":return Xn.set(R)}},T=x=>{m=x.data.hand,n(2,h=!1),a(x.type,x)},g=x=>{a(x.type,x),ze(x.type,x)},{start:b,stop:A}=ei(()=>{var ke;const x=l.getFrame(),R=m==null?void 0:m.get("wrist");if(R===void 0||d===null)return;const S=(ke=x.getJointPose)==null?void 0:ke.call(x,R,d);if(S==null)return;const{position:y,orientation:K}=S.transform;p.position.set(y.x,y.y,y.z),p.quaternion.set(K.x,K.y,K.z,K.w)},{autostart:!1});Pe(()=>{u.addEventListener("connected",_),u.addEventListener("disconnected",T),u.addEventListener("pinchstart",g),u.addEventListener("pinchend",g)}),P(()=>{u.removeEventListener("connected",_),u.removeEventListener("disconnected",T),u.removeEventListener("pinchstart",g),u.removeEventListener("pinchend",g)});function M(x){p=x,n(3,p)}return i.$$set=x=>{"index"in x&&n(0,o=x.index),"profile"in x&&n(1,c=x.profile),"$$scope"in x&&n(8,s=x.$$scope)},r.default?b():A(),[o,c,h,p,u,f,t,M,s]}class So extends Y{constructor(e){super(),Q(this,e,Eo,yo,q,{index:0,profile:1})}}function rn(i,e,n){const t=i.slice();return t[10]=e[n],t}const wo=i=>({}),on=i=>({}),xo=i=>({}),an=i=>({});function vo(i){let e;const n=i[4].right,t=$(n,i,i[9],on);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&512)&&ee(t,n,s,s[9],e?ne(n,s[9],r,wo):te(s[9]),on)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function Ro(i){let e;const n=i[4].left,t=$(n,i,i[9],an);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&512)&&ee(t,n,s,s[9],e?ne(n,s[9],r,xo):te(s[9]),an)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function Mo(i){let e,n,t,s;const r=[Ro,vo],o=[];function c(a,l){return a[1][a[10]]==="left"?0:a[1][a[10]]==="right"?1:-1}return~(e=c(i))&&(n=o[e]=r[e](i)),{c(){n&&n.c(),t=me()},l(a){n&&n.l(a),t=ge(a)},m(a,l){~e&&o[e].m(a,l),I(a,t,l),s=!0},p(a,l){let u=e;e=c(a),e===u?~e&&o[e].p(a,l):(n&&(le(),w(o[u],1,1,()=>{o[u]=null}),ue()),~e?(n=o[e],n?n.p(a,l):(n=o[e]=r[e](a),n.c()),E(n,1),n.m(t.parentNode,t)):n=null)},i(a){s||(E(n),s=!0)},o(a){w(n),s=!1},d(a){a&&N(t),~e&&o[e].d(a)}}}function cn(i,e){let n,t,s;function r(...o){return e[5](e[10],...o)}return t=new So({props:{index:e[10],profile:e[0],$$slots:{default:[Mo]},$$scope:{ctx:e}}}),t.$on("connected",r),t.$on("disconnected",e[6]),t.$on("pinchstart",e[7]),t.$on("pinchend",e[8]),{key:i,first:null,c(){n=ae(),k(t.$$.fragment),this.h()},l(o){n=ae(),D(t.$$.fragment,o),this.h()},h(){this.first=n},m(o,c){I(o,n,c),F(t,o,c),s=!0},p(o,c){e=o;const a={};c&1&&(a.profile=e[0]),c&514&&(a.$$scope={dirty:c,ctx:e}),t.$set(a)},i(o){s||(E(t.$$.fragment,o),s=!0)},o(o){w(t.$$.fragment,o),s=!1},d(o){o&&N(n),H(t,o)}}}function Lo(i){let e=[],n=new Map,t,s,r=Pt([0,1]);const o=c=>c[10];for(let c=0;c<2;c+=1){let a=rn(i,r,c),l=o(a);n.set(l,e[c]=cn(l,a))}return{c(){for(let c=0;c<2;c+=1)e[c].c();t=ae()},l(c){for(let a=0;a<2;a+=1)e[a].l(c);t=ae()},m(c,a){for(let l=0;l<2;l+=1)e[l]&&e[l].m(c,a);I(c,t,a),s=!0},p(c,[a]){a&527&&(r=Pt([0,1]),le(),e=er(e,a,o,1,c,r,n,t.parentNode,tr,cn,t,rn),ue())},i(c){if(!s){for(let a=0;a<2;a+=1)E(e[a]);s=!0}},o(c){for(let a=0;a<2;a+=1)w(e[a]);s=!1},d(c){c&&N(t);for(let a=0;a<2;a+=1)e[a].d(c)}}}function No(i,e,n){let{$$slots:t={},$$scope:s}=e,{profile:r="mesh"}=e;const o=Le(),c=[void 0,void 0],a=(h,m)=>{m.data&&n(1,c[h]=m.data.handedness,c)},l=(h,m)=>{a(h,m),o(m.type,m)};function u(h){Je.call(this,i,h)}function d(h){Je.call(this,i,h)}function f(h){Je.call(this,i,h)}return i.$$set=h=>{"profile"in h&&n(0,r=h.profile),"$$scope"in h&&n(9,s=h.$$scope)},[r,c,o,a,t,l,u,d,f,s]}class ta extends Y{constructor(e){super(),Q(this,e,No,Lo,q,{profile:0})}}Ue.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new bt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Be.line={uniforms:Cn.merge([Ue.common,Ue.fog,Ue.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class xt extends Qs{constructor(e){super({type:"LineMaterial",uniforms:Cn.clone(Be.line.uniforms),vertexShader:Be.line.vertexShader,fragmentShader:Be.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(n){this.uniforms.diffuse.value=n}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(n){this.uniforms.linewidth.value=n}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(n){!!n!="USE_DASH"in this.defines&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(n){this.uniforms.dashScale.value=n}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(n){this.uniforms.dashSize.value=n}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(n){this.uniforms.dashOffset.value=n}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(n){this.uniforms.gapSize.value=n}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(n){this.uniforms.resolution.value.copy(n)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(n){!!n!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const ln=new Ye,Fe=new G;class Wn extends Js{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],t=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(t),this.setAttribute("position",new It(e,3)),this.setAttribute("uv",new It(n,2))}applyMatrix4(e){const n=this.attributes.instanceStart,t=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(e),t.applyMatrix4(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const t=new dt(n,6,1);return this.setAttribute("instanceStart",new Ae(t,3,0)),this.setAttribute("instanceEnd",new Ae(t,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const t=new dt(n,6,1);return this.setAttribute("instanceColorStart",new Ae(t,3,0)),this.setAttribute("instanceColorEnd",new Ae(t,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Zs(e.geometry)),this}fromLineSegments(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ye);const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;e!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(e),ln.setFromBufferAttribute(n),this.boundingBox.union(ln))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Tt),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(e!==void 0&&n!==void 0){const t=this.boundingSphere.center;this.boundingBox.getCenter(t);let s=0;for(let r=0,o=e.count;r<o;r++)Fe.fromBufferAttribute(e,r),s=Math.max(s,t.distanceToSquared(Fe)),Fe.fromBufferAttribute(n,r),s=Math.max(s,t.distanceToSquared(Fe));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class vt extends Wn{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const n=e.length-3,t=new Float32Array(2*n);for(let s=0;s<n;s+=3)t[2*s]=e[s],t[2*s+1]=e[s+1],t[2*s+2]=e[s+2],t[2*s+3]=e[s+3],t[2*s+4]=e[s+4],t[2*s+5]=e[s+5];return super.setPositions(t),this}setColors(e){const n=e.length-3,t=new Float32Array(2*n);for(let s=0;s<n;s+=3)t[2*s]=e[s],t[2*s+1]=e[s+1],t[2*s+2]=e[s+2],t[2*s+3]=e[s+3],t[2*s+4]=e[s+4],t[2*s+5]=e[s+5];return super.setColors(t),this}fromLine(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}}const un=new G,dn=new G,j=new Qe,U=new Qe,se=new Qe,ot=new G,at=new Me,B=new $s,fn=new G,He=new Ye,je=new Tt,re=new Qe;let ie,ye;function hn(i,e,n){return re.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),re.multiplyScalar(1/re.w),re.x=ye/n.width,re.y=ye/n.height,re.applyMatrix4(i.projectionMatrixInverse),re.multiplyScalar(1/re.w),Math.abs(Math.max(re.x,re.y))}function Co(i,e){const n=i.matrixWorld,t=i.geometry,s=t.attributes.instanceStart,r=t.attributes.instanceEnd,o=Math.min(t.instanceCount,s.count);for(let c=0,a=o;c<a;c++){B.start.fromBufferAttribute(s,c),B.end.fromBufferAttribute(r,c),B.applyMatrix4(n);const l=new G,u=new G;ie.distanceSqToSegment(B.start,B.end,u,l),u.distanceTo(l)<ye*.5&&e.push({point:u,pointOnLine:l,distance:ie.origin.distanceTo(u),object:i,face:null,faceIndex:c,uv:null,uv1:null})}}function Oo(i,e,n){const t=e.projectionMatrix,r=i.material.resolution,o=i.matrixWorld,c=i.geometry,a=c.attributes.instanceStart,l=c.attributes.instanceEnd,u=Math.min(c.instanceCount,a.count),d=-e.near;ie.at(1,se),se.w=1,se.applyMatrix4(e.matrixWorldInverse),se.applyMatrix4(t),se.multiplyScalar(1/se.w),se.x*=r.x/2,se.y*=r.y/2,se.z=0,ot.copy(se),at.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,h=u;f<h;f++){if(j.fromBufferAttribute(a,f),U.fromBufferAttribute(l,f),j.w=1,U.w=1,j.applyMatrix4(at),U.applyMatrix4(at),j.z>d&&U.z>d)continue;if(j.z>d){const b=j.z-U.z,A=(j.z-d)/b;j.lerp(U,A)}else if(U.z>d){const b=U.z-j.z,A=(U.z-d)/b;U.lerp(j,A)}j.applyMatrix4(t),U.applyMatrix4(t),j.multiplyScalar(1/j.w),U.multiplyScalar(1/U.w),j.x*=r.x/2,j.y*=r.y/2,U.x*=r.x/2,U.y*=r.y/2,B.start.copy(j),B.start.z=0,B.end.copy(U),B.end.z=0;const p=B.closestPointToPointParameter(ot,!0);B.at(p,fn);const _=Rn.lerp(j.z,U.z,p),T=_>=-1&&_<=1,g=ot.distanceTo(fn)<ye*.5;if(T&&g){B.start.fromBufferAttribute(a,f),B.end.fromBufferAttribute(l,f),B.start.applyMatrix4(o),B.end.applyMatrix4(o);const b=new G,A=new G;ie.distanceSqToSegment(B.start,B.end,A,b),n.push({point:A,pointOnLine:b,distance:ie.origin.distanceTo(A),object:i,face:null,faceIndex:f,uv:null,uv1:null})}}}class Io extends yt{constructor(e=new Wn,n=new xt({color:Math.random()*16777215})){super(e,n),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,n=e.attributes.instanceStart,t=e.attributes.instanceEnd,s=new Float32Array(2*n.count);for(let o=0,c=0,a=n.count;o<a;o++,c+=2)un.fromBufferAttribute(n,o),dn.fromBufferAttribute(t,o),s[c]=c===0?0:s[c-1],s[c+1]=s[c]+un.distanceTo(dn);const r=new dt(s,2,1);return e.setAttribute("instanceDistanceStart",new Ae(r,1,0)),e.setAttribute("instanceDistanceEnd",new Ae(r,1,1)),this}raycast(e,n){const t=this.material.worldUnits,s=e.camera;s===null&&!t&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ie=e.ray;const o=this.matrixWorld,c=this.geometry,a=this.material;ye=a.linewidth+r,c.boundingSphere===null&&c.computeBoundingSphere(),je.copy(c.boundingSphere).applyMatrix4(o);let l;if(t)l=ye*.5;else{const d=Math.max(s.near,je.distanceToPoint(ie.origin));l=hn(s,d,a.resolution)}if(je.radius+=l,ie.intersectsSphere(je)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),He.copy(c.boundingBox).applyMatrix4(o);let u;if(t)u=ye*.5;else{const d=Math.max(s.near,He.distanceToPoint(ie.origin));u=hn(s,d,a.resolution)}He.expandByScalar(u),ie.intersectsBox(He)!==!1&&(t?Co(this,n):Oo(this,s,n))}}class Po extends Io{constructor(e=new vt,n=new xt({color:Math.random()*16777215})){super(e,n),this.isLine2=!0,this.type="Line2"}}function ko(i){let e,n,t,s;return e=new W({props:{is:i[1]}}),t=new W.LineMaterial({props:{color:i[0],linewidth:.004}}),{c(){k(e.$$.fragment),n=me(),k(t.$$.fragment)},l(r){D(e.$$.fragment,r),n=ge(r),D(t.$$.fragment,r)},m(r,o){F(e,r,o),I(r,n,o),F(t,r,o),s=!0},p(r,o){const c={};o&1&&(c.color=r[0]),t.$set(c)},i(r){s||(E(e.$$.fragment,r),E(t.$$.fragment,r),s=!0)},o(r){w(e.$$.fragment,r),w(t.$$.fragment,r),s=!1},d(r){r&&N(n),H(e,r),H(t,r)}}}function Do(i){let e,n;const t=[i[2],{"position.z":-.01}];let s={$$slots:{default:[ko]},$$scope:{ctx:i}};for(let r=0;r<t.length;r+=1)s=J(s,t[r]);return e=new W.Line2({props:s}),{c(){k(e.$$.fragment)},l(r){D(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,[o]){const c=o&4?Et(t,[On(r[2]),t[1]]):{};o&17&&(c.$$scope={dirty:o,ctx:r}),e.$set(c)},i(r){n||(E(e.$$.fragment,r),n=!0)},o(r){w(e.$$.fragment,r),n=!1},d(r){H(e,r)}}}Jr({Line2:Po,LineGeometry:vt,LineMaterial:xt});function Fo(i,e,n){const t=["positions","color"];let s=pe(e,t),{positions:r}=e,{color:o="white"}=e,c=new vt;return i.$$set=a=>{e=J(J({},e),Ce(a)),n(2,s=pe(e,t)),"positions"in a&&n(3,r=a.positions),"color"in a&&n(0,o=a.color)},i.$$.update=()=>{i.$$.dirty&8&&r&&c.setPositions(r)},[o,c,s,r]}class na extends Y{constructor(e){super(),Q(this,e,Fo,Do,q,{positions:3,color:0})}}function pn(i){let e;const n=i[8].default,t=$(n,i,i[7],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,r){t&&t.m(s,r),e=!0},p(s,r){t&&t.p&&(!e||r&128)&&ee(t,n,s,s[7],e?ne(n,s[7],r,null):te(s[7]),null)},i(s){e||(E(t,s),e=!0)},o(s){w(t,s),e=!1},d(s){t&&t.d(s)}}}function Ho(i){let e,n,t=i[0]&&pn(i);return{c(){t&&t.c(),e=ae()},l(s){t&&t.l(s),e=ae()},m(s,r){t&&t.m(s,r),I(s,e,r),n=!0},p(s,[r]){s[0]?t?(t.p(s,r),r&1&&E(t,1)):(t=pn(s),t.c(),E(t,1),t.m(e.parentNode,e)):t&&(le(),w(t,1,1,()=>{t=null}),ue())},i(s){n||(E(t),n=!0)},o(s){w(t),n=!1},d(s){s&&N(e),t&&t.d(s)}}}function jo(i,e,n){let t,s,r,o,c,a;z(i,Ge,y=>n(9,t=y)),z(i,Ke,y=>n(10,s=y)),z(i,ve,y=>n(6,r=y)),z(i,ht,y=>n(11,o=y)),z(i,ft,y=>n(12,c=y)),z(i,nt,y=>n(0,a=y));let{$$slots:l={},$$scope:u}=e,{foveation:d=0}=e,{frameRate:f=void 0}=e,{referenceSpace:h="local-floor"}=e;const m=Le(),{xr:p}=we().renderer,_=y=>{de(nt,a=!0,a),m("sessionstart",{...y,target:r})},T=y=>{m("sessionend",{...y,target:r}),de(nt,a=!1,a),de(ve,r=void 0,r)},g=y=>{m("visibilitychange",{...y,target:r})},b=y=>{de(ft,c=Object.values(r.inputSources).some(K=>K.hand),c),m("inputsourceschange",{...y,target:r})},A=y=>{m("visibilitychange",{...y,target:r})},M=y=>{if(y!==void 0)try{r==null||r.updateTargetFrameRate(y)}catch{}},x=y=>{y!==void 0&&(y.removeEventListener("visibilitychange",g),y.removeEventListener("inputsourceschange",b),y.removeEventListener("frameratechange",A))},R=async y=>{y!==void 0&&(y.addEventListener("visibilitychange",g),y.addEventListener("inputsourceschange",b),y.addEventListener("frameratechange",A),p.setFoveation(d),M(f))};p.enabled=!0,p.addEventListener("sessionstart",_),p.addEventListener("sessionend",T);let S;return de(Ke,s=p,s),de(Ge,t=!0,t),P(()=>{de(Ge,t=!1,t),n(4,p.enabled=!1,p),p.removeEventListener("sessionstart",_),p.removeEventListener("sessionend",T)}),i.$$set=y=>{"foveation"in y&&n(1,d=y.foveation),"frameRate"in y&&n(2,f=y.frameRate),"referenceSpace"in y&&n(3,h=y.referenceSpace),"$$scope"in y&&n(7,u=y.$$scope)},i.$$.update=()=>{i.$$.dirty&24&&(p.setReferenceSpaceType(h),de(ht,o=h,o)),i.$$.dirty&96&&S!==r&&(x(S),R(r),n(5,S=r)),i.$$.dirty&4&&M(f),i.$$.dirty&18&&p.setFoveation(d)},[a,d,f,h,p,S,r,u,l]}class sa extends Y{constructor(e){super(),Q(this,e,jo,Ho,q,{foveation:1,frameRate:2,referenceSpace:3})}}export{qo as B,Wo as C,Bn as G,ta as H,na as R,gr as S,W as T,sa as X,On as a,ei as b,Zo as c,C as d,ea as e,ft as f,Et as g,Le as h,nt as i,Xo as j,ti as k,Yo as l,Qo as m,$o as n,Jo as o,ni as p,ve as s,we as u,Fn as w,Ke as x};
