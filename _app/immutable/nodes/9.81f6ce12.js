import{F as fe,s as V,B as I,C as J,D as ie,a as z,c as S,i as C,y as L,d as x,p as le,G as $e,z as K,b as me,o as ue,r as ce,u as pe,v as _e,w as ge,M as j,H as de}from"../chunks/scheduler.198d0952.js";import{S as X,i as H,b as p,d as _,m as g,a as u,t as c,e as d,f as ve}from"../chunks/index.2f815148.js";import{u as Y,s as ye,Q as be,T as M,g as we,a as he,bO as Me,bP as W,bQ as q,b8 as ze,k as Se,V as Q,M as Ce,bR as xe,b as N,bS as Pe,bT as Re,X as ke,H as De,e as Te}from"../chunks/xr.09021ec0.js";import{B as Oe}from"../chunks/button-vr.4051b1a3.js";import{e as Fe}from"../chunks/each.7df61979.js";import{C as Ge}from"../chunks/controllers.549573d7.js";const Ue=new be,F={x:0,y:0,z:0},Z=()=>{const{xr:o}=Y().renderer;let t;const n=ye.subscribe(r=>{r!==void 0&&(t=o.getReferenceSpace())});return fe(()=>n()),(r,s=Ue)=>{if(t==null)return;let e=0,f=0,m=0;Array.isArray(r)?[e,f,m]=r:(e=r.x,f=r.y,m=r.z),F.x=-e,F.y=-f,F.z=-m;const v=o.getFrame().getViewerPose(t);v!==void 0&&(F.x+=v.transform.position.x,F.z+=v.transform.position.z);const y=new XRRigidTransform(F,s);o.setReferenceSpace(t.getOffsetReferenceSpace(y))}};function Ae(o){let t,n,r,s;return t=new M.PlaneGeometry({props:{args:[.5,.5]}}),t.$on("create",o[3]),r=new M.ShaderMaterial({props:{fragmentShader:o[0],vertexShader:o[1],transparent:!0,polygonOffset:!0,polygonOffsetFactor:-1}}),r.$on("create",je),{c(){p(t.$$.fragment),n=z(),p(r.$$.fragment)},l(e){_(t.$$.fragment,e),n=S(e),_(r.$$.fragment,e)},m(e,f){g(t,e,f),C(e,n,f),g(r,e,f),s=!0},p:L,i(e){s||(u(t.$$.fragment,e),u(r.$$.fragment,e),s=!0)},o(e){c(t.$$.fragment,e),c(r.$$.fragment,e),s=!1},d(e){e&&x(n),d(t,e),d(r,e)}}}function Be(o){let t,n;const r=[{name:"Teleport Marker"},{renderOrder:9999},o[2]];let s={$$slots:{default:[Ae]},$$scope:{ctx:o}};for(let e=0;e<r.length;e+=1)s=I(s,r[e]);return t=new M.Mesh({props:s}),{c(){p(t.$$.fragment)},l(e){_(t.$$.fragment,e)},m(e,f){g(t,e,f),n=!0},p(e,[f]){const m=f&4?we(r,[r[0],r[1],he(e[2])]):{};f&16&&(m.$$scope={dirty:f,ctx:e}),t.$set(m)},i(e){n||(u(t.$$.fragment,e),n=!0)},o(e){c(t.$$.fragment,e),n=!1},d(e){d(t,e)}}}const je=({ref:o})=>o.uniforms.size={value:10};function Qe(o,t,n){const r=[];let s=J(t,r);const e=`
uniform float time;
uniform float size;
varying vec2 vUv;
void main(){
  float sinx = sin(time) / 8. + 0.3;
  float strength = 1.0 - step(0.01, abs(distance(vUv, vec2(0.5)) - sinx));

  // float strength = 1.0 - step(0.01, abs(distance(vUv, vec2(0.5)) - size));
  gl_FragColor = vec4(strength);
}`,f=`
varying vec2 vUv;
void main(){
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,m=({ref:v})=>v.rotateX(-Math.PI/2);return o.$$set=v=>{t=I(I({},t),ie(v)),n(2,s=J(t,r))},[e,f,s,m]}class Ve extends X{constructor(t){super(),H(this,t,Qe,Be,V,{})}}function Xe(o){let t;const n=o[7].default,r=ce(n,o,o[9],null);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,e){r&&r.m(s,e),t=!0},p(s,e){r&&r.p&&(!t||e&512)&&pe(r,n,s,s[9],t?ge(n,s[9],e,null):_e(s[9]),null)},i(s){t||(u(r,s),t=!0)},o(s){c(r,s),t=!1},d(s){r&&r.d(s)}}}function He(o){var R,b,i;let t,n,r,s,e,f,m;function v(a){o[8](a)}let y={$$slots:{default:[Xe]},$$scope:{ctx:o}};return o[0]!==void 0&&(y.ref=o[0]),t=new M.Group({props:y}),le.push(()=>ve(t,"ref",v)),s=new Me({props:{visible:o[2]!==void 0&&o[1]!==void 0,positions:o[3]}}),f=new Ve({props:{visible:o[2]!==void 0&&o[1]!==void 0,"position.x":(R=o[1])==null?void 0:R.x,"position.y":(b=o[1])==null?void 0:b.y,"position.z":(i=o[1])==null?void 0:i.z}}),{c(){p(t.$$.fragment),r=z(),p(s.$$.fragment),e=z(),p(f.$$.fragment)},l(a){_(t.$$.fragment,a),r=S(a),_(s.$$.fragment,a),e=S(a),_(f.$$.fragment,a)},m(a,$){g(t,a,$),C(a,r,$),g(s,a,$),C(a,e,$),g(f,a,$),m=!0},p(a,[$]){var O,G,k;const w={};$&512&&(w.$$scope={dirty:$,ctx:a}),!n&&$&1&&(n=!0,w.ref=a[0],$e(()=>n=!1)),t.$set(w);const h={};$&6&&(h.visible=a[2]!==void 0&&a[1]!==void 0),$&8&&(h.positions=a[3]),s.$set(h);const D={};$&6&&(D.visible=a[2]!==void 0&&a[1]!==void 0),$&2&&(D["position.x"]=(O=a[1])==null?void 0:O.x),$&2&&(D["position.y"]=(G=a[1])==null?void 0:G.y),$&2&&(D["position.z"]=(k=a[1])==null?void 0:k.z),f.$set(D)},i(a){m||(u(t.$$.fragment,a),u(s.$$.fragment,a),u(f.$$.fragment,a),m=!0)},o(a){c(t.$$.fragment,a),c(s.$$.fragment,a),c(f.$$.fragment,a),m=!1},d(a){a&&(x(r),x(e)),d(t,a),d(s,a),d(f,a)}}}const E=40;function We(o,t,n){let r,s,e,f;K(o,W,l=>n(14,e=l)),K(o,q,l=>n(15,f=l));let{$$slots:m={},$$scope:v}=t,{raycaster:y=new ze}=t,{handedness:R="right"}=t,{maxDistance:b=20}=t;const i=Se();let a,$=[],w,h;const D=Z(),O=new Q,G=new Ce,k=new Q,T=new Float32Array(E*3),U=new xe,A=new Q,ee=(l,P)=>{k.x=(l.x+P.x)/2,k.y=(l.y+P.y)/2,k.z=(l.z+P.z)/2},{start:te,stop:re}=N(()=>{if(h===void 0)return;G.identity().extractRotation(h.matrixWorld),y.ray.origin.setFromMatrixPosition(h.matrixWorld),y.ray.direction.set(0,0,-1).applyMatrix4(G);const[l]=y.intersectObjects($);if(l===void 0){n(1,w=void 0),j(q,f=void 0,f);return}n(1,w=l.point),j(q,f=w,f),h.getWorldPosition(O),ee(O,w),k.y+=.8,U.v0.copy(O),U.v1.copy(k),U.v2.copy(l.point);for(let P=0,B=0;P<E;P+=1,B+=3){const oe=P/E;U.getPoint(oe,A),n(3,T[B+0]=A.x,T),n(3,T[B+1]=A.y,T),n(3,T[B+2]=A.z,T)}},{autostart:!1}),ne=l=>{n(2,h=l),j(W,e=l,e),te()},se=()=>{re(),n(2,h=void 0),j(W,e=void 0,e),w!==void 0&&(D(w),i("teleport",w))};N(()=>{var P;const l=(((P=s.current)==null?void 0:P.axes[3])??0)<-.9;l&&h===void 0?ne(r.current.controller):!l&&h!==void 0&&se()}),me(()=>{$=a.children}),ue(()=>{$=a.children});function ae(l){a=l,n(0,a)}return o.$$set=l=>{"raycaster"in l&&n(4,y=l.raycaster),"handedness"in l&&n(5,R=l.handedness),"maxDistance"in l&&n(6,b=l.maxDistance),"$$scope"in l&&n(9,v=l.$$scope)},o.$$.update=()=>{o.$$.dirty&64&&n(4,y.far=b,y),o.$$.dirty&32&&(r=Pe(R)),o.$$.dirty&32&&(s=Re(R))},[a,w,h,T,y,R,b,m,ae,v]}class qe extends X{constructor(t){super(),H(this,t,We,He,V,{raycaster:4,handedness:5,maxDistance:6})}}function Ee(o,t,n){const r=o.slice();return r[3]=t[n],r}function Ie(o){let t,n,r,s;return t=new Ge({}),r=new De({}),{c(){p(t.$$.fragment),n=z(),p(r.$$.fragment)},l(e){_(t.$$.fragment,e),n=S(e),_(r.$$.fragment,e)},m(e,f){g(t,e,f),C(e,n,f),g(r,e,f),s=!0},i(e){s||(u(t.$$.fragment,e),u(r.$$.fragment,e),s=!0)},o(e){c(t.$$.fragment,e),c(r.$$.fragment,e),s=!1},d(e){e&&x(n),d(t,e),d(r,e)}}}function Le(o){let t,n,r,s;return t=new M.CircleGeometry({props:{args:[20]}}),r=new M.MeshStandardMaterial({props:{color:"#444"}}),{c(){p(t.$$.fragment),n=z(),p(r.$$.fragment)},l(e){_(t.$$.fragment,e),n=S(e),_(r.$$.fragment,e)},m(e,f){g(t,e,f),C(e,n,f),g(r,e,f),s=!0},p:L,i(e){s||(u(t.$$.fragment,e),u(r.$$.fragment,e),s=!0)},o(e){c(t.$$.fragment,e),c(r.$$.fragment,e),s=!1},d(e){e&&x(n),d(t,e),d(r,e)}}}function Je(o){let t,n;return t=new M.Mesh({props:{rotation:[-Math.PI/2,0,0],$$slots:{default:[Le]},$$scope:{ctx:o}}}),{c(){p(t.$$.fragment)},l(r){_(t.$$.fragment,r)},m(r,s){g(t,r,s),n=!0},p(r,s){const e={};s&64&&(e.$$scope={dirty:s,ctx:r}),t.$set(e)},i(r){n||(u(t.$$.fragment,r),n=!0)},o(r){c(t.$$.fragment,r),n=!1},d(r){d(t,r)}}}function Ke(o){let t,n,r,s;return t=new M.CylinderGeometry({props:{args:[1,1,.1]}}),r=new M.MeshStandardMaterial({props:{color:"#fff"}}),{c(){p(t.$$.fragment),n=z(),p(r.$$.fragment)},l(e){_(t.$$.fragment,e),n=S(e),_(r.$$.fragment,e)},m(e,f){g(t,e,f),C(e,n,f),g(r,e,f),s=!0},p:L,i(e){s||(u(t.$$.fragment,e),u(r.$$.fragment,e),s=!0)},o(e){c(t.$$.fragment,e),c(r.$$.fragment,e),s=!1},d(e){e&&x(n),d(t,e),d(r,e)}}}function Ne(o){let t,n;return t=new M.Mesh({props:{position:o[3],renderOrder:10,$$slots:{default:[Ke]},$$scope:{ctx:o}}}),{c(){p(t.$$.fragment)},l(r){_(t.$$.fragment,r)},m(r,s){g(t,r,s),n=!0},p(r,s){const e={};s&64&&(e.$$scope={dirty:s,ctx:r}),t.$set(e)},i(r){n||(u(t.$$.fragment,r),n=!0)},o(r){c(t.$$.fragment,r),n=!1},d(r){d(t,r)}}}function Ye(o){let t,n,r,s,e,f,m,v,y;t=new ke({props:{$$slots:{default:[Ie]},$$scope:{ctx:o}}}),r=new qe({props:{handedness:"left",$$slots:{default:[Je]},$$scope:{ctx:o}}});let R=Fe([[0,0,8],[8,0,0],[0,0,-8],[-8,0,3]]),b=[];for(let i=0;i<4;i+=1)b[i]=Ne(Ee(o,R,i));return f=new M.AmbientLight({}),v=new M.DirectionalLight({}),{c(){p(t.$$.fragment),n=z(),p(r.$$.fragment),s=z();for(let i=0;i<4;i+=1)b[i].c();e=z(),p(f.$$.fragment),m=z(),p(v.$$.fragment)},l(i){_(t.$$.fragment,i),n=S(i),_(r.$$.fragment,i),s=S(i);for(let a=0;a<4;a+=1)b[a].l(i);e=S(i),_(f.$$.fragment,i),m=S(i),_(v.$$.fragment,i)},m(i,a){g(t,i,a),C(i,n,a),g(r,i,a),C(i,s,a);for(let $=0;$<4;$+=1)b[$]&&b[$].m(i,a);C(i,e,a),g(f,i,a),C(i,m,a),g(v,i,a),y=!0},p(i,[a]){const $={};a&64&&($.$$scope={dirty:a,ctx:i}),t.$set($);const w={};a&64&&(w.$$scope={dirty:a,ctx:i}),r.$set(w)},i(i){if(!y){u(t.$$.fragment,i),u(r.$$.fragment,i);for(let a=0;a<4;a+=1)u(b[a]);u(f.$$.fragment,i),u(v.$$.fragment,i),y=!0}},o(i){c(t.$$.fragment,i),c(r.$$.fragment,i),b=b.filter(Boolean);for(let a=0;a<4;a+=1)c(b[a]);c(f.$$.fragment,i),c(v.$$.fragment,i),y=!1},d(i){i&&(x(n),x(s),x(e),x(m)),d(t,i),d(r,i),de(b,i),d(f,i),d(v,i)}}}function Ze(o){const{camera:t,renderer:n}=Y(),r=Z();return n.setClearColor(0),t.current.position.z=1.75,t.current.lookAt(0,1.75,1),r(new Q(.5,0,.5)),[]}class et extends X{constructor(t){super(),H(this,t,Ze,Ye,V,{})}}function tt(o){let t,n;return t=new et({}),{c(){p(t.$$.fragment)},l(r){_(t.$$.fragment,r)},m(r,s){g(t,r,s),n=!0},i(r){n||(u(t.$$.fragment,r),n=!0)},o(r){c(t.$$.fragment,r),n=!1},d(r){d(t,r)}}}function rt(o){let t,n,r,s;return t=new Te({props:{$$slots:{default:[tt]},$$scope:{ctx:o}}}),r=new Oe({}),{c(){p(t.$$.fragment),n=z(),p(r.$$.fragment)},l(e){_(t.$$.fragment,e),n=S(e),_(r.$$.fragment,e)},m(e,f){g(t,e,f),C(e,n,f),g(r,e,f),s=!0},p(e,[f]){const m={};f&1&&(m.$$scope={dirty:f,ctx:e}),t.$set(m)},i(e){s||(u(t.$$.fragment,e),u(r.$$.fragment,e),s=!0)},o(e){c(t.$$.fragment,e),c(r.$$.fragment,e),s=!1},d(e){e&&x(n),d(t,e),d(r,e)}}}class lt extends X{constructor(t){super(),H(this,t,null,rt,V,{})}}export{lt as component};
