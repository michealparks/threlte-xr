import{s as B,B as T,C as G,D as E,E as I,F as L,p as N,a as v,e as C,c as k,i as y,G as U,d as w,y as O}from"../chunks/scheduler.92454ee1.js";import{S as F,i as P,b as _,d as g,m as d,a as c,t as p,e as h,f as z,g as J,c as K}from"../chunks/index.e18f9c40.js";import{B as Q,g as V,a as W,u as Y,s as Z,b as ee,X as te,T as x,H as re,C as ne}from"../chunks/xr.bf805c76.js";import{e as X,u as se,o as ae}from"../chunks/each.258ac6aa.js";import{M as oe,C as fe,a as ie,b as le}from"../chunks/three.module.445e1080.js";import{C as me}from"../chunks/controllers.b58dc4c2.js";function ue(i){let t,s;const r=[i[0],{mode:"immersive-ar"},{sessionInit:{domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]}}];let a={};for(let e=0;e<r.length;e+=1)a=T(a,r[e]);return t=new Q({props:a}),t.$on("click",i[1]),t.$on("error",i[2]),{c(){_(t.$$.fragment)},l(e){g(t.$$.fragment,e)},m(e,f){d(t,e,f),s=!0},p(e,[f]){const m=f&1?V(r,[f&1&&W(e[0]),r[1],f&0&&{sessionInit:{domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]}}]):{};t.$set(m)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){h(t,e)}}}function $e(i,t,s){const r=[];let a=G(t,r);function e(m){I.call(this,i,m)}function f(m){I.call(this,i,m)}return i.$$set=m=>{t=T(T({},t),E(m)),s(0,a=G(t,r))},[a,e,f]}class ce extends F{constructor(t){super(),P(this,t,$e,ue,B,{})}}const pe=i=>{const{xr:t}=Y().renderer,s=new oe;let r=!1,a;const e=Z.subscribe(async l=>{var u;if(l===void 0){a=void 0,r&&(m(),r=!1);return}const $=await l.requestReferenceSpace("viewer");a=await((u=l.requestHitTestSource)==null?void 0:u.call(l,{space:$})),r||(f(),r=!0)}),{start:f,stop:m}=ee(()=>{if(a===void 0)return;const[l]=t.getFrame().getHitTestResults(a);if(l===void 0)return;const $=t.getReferenceSpace();if($===null)return;const u=l.getPose($);u!==void 0&&(s.fromArray(u.transform.matrix),i(s,l))},{autostart:!1});L(()=>{m(),e()})};function A(i,t,s){const r=i.slice();return r[6]=t[s],r[8]=s,r}function _e(i){let t,s,r,a;return t=new me({}),t.$on("select",i[2]),r=new re({}),r.$on("pinchend",i[2]),{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment)},l(e){g(t.$$.fragment,e),s=k(e),g(r.$$.fragment,e)},m(e,f){d(t,e,f),y(e,s,f),d(r,e,f),a=!0},p:O,i(e){a||(c(t.$$.fragment,e),c(r.$$.fragment,e),a=!0)},o(e){p(t.$$.fragment,e),p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(t,e),h(r,e)}}}function ge(i){let t,s,r,a;return t=new x.RingGeometry({props:{args:[.15,.2,32]}}),t.$on("create",i[3]),r=new x.MeshBasicMaterial({}),{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment)},l(e){g(t.$$.fragment,e),s=k(e),g(r.$$.fragment,e)},m(e,f){d(t,e,f),y(e,s,f),d(r,e,f),a=!0},p:O,i(e){a||(c(t.$$.fragment,e),c(r.$$.fragment,e),a=!0)},o(e){p(t.$$.fragment,e),p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(t,e),h(r,e)}}}function D(i,t){let s,r,a;return r=new x({props:{is:t[6]}}),{key:i,first:null,c(){s=C(),_(r.$$.fragment),this.h()},l(e){s=C(),g(r.$$.fragment,e),this.h()},h(){this.first=s},m(e,f){y(e,s,f),d(r,e,f),a=!0},p(e,f){t=e},i(e){a||(c(r.$$.fragment,e),a=!0)},o(e){p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(r,e)}}}function de(i){let t,s,r,a,e,f,m,l=[],$=new Map,u,S;t=new te({props:{foveation:1,$$slots:{default:[_e]},$$scope:{ctx:i}}}),r=new x.HemisphereLight({props:{args:[16777215,12303359,1],position:[.5,1,.25]}});function j(n){i[4](n)}let q={matrixAutoUpdate:!1,visible:!1,$$slots:{default:[ge]},$$scope:{ctx:i}};i[0]!==void 0&&(q.ref=i[0]),e=new x.Mesh({props:q}),N.push(()=>z(e,"ref",j));let M=X(i[1]);const R=n=>n[8];for(let n=0;n<M.length;n+=1){let o=A(i,M,n),b=R(o);$.set(b,l[n]=D(b,o))}return{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment),a=v(),_(e.$$.fragment),m=v();for(let n=0;n<l.length;n+=1)l[n].c();u=C()},l(n){g(t.$$.fragment,n),s=k(n),g(r.$$.fragment,n),a=k(n),g(e.$$.fragment,n),m=k(n);for(let o=0;o<l.length;o+=1)l[o].l(n);u=C()},m(n,o){d(t,n,o),y(n,s,o),d(r,n,o),y(n,a,o),d(e,n,o),y(n,m,o);for(let b=0;b<l.length;b+=1)l[b]&&l[b].m(n,o);y(n,u,o),S=!0},p(n,[o]){const b={};o&512&&(b.$$scope={dirty:o,ctx:n}),t.$set(b);const H={};o&512&&(H.$$scope={dirty:o,ctx:n}),!f&&o&1&&(f=!0,H.ref=n[0],U(()=>f=!1)),e.$set(H),o&2&&(M=X(n[1]),J(),l=se(l,o,R,1,n,M,$,u.parentNode,ae,D,u,A),K())},i(n){if(!S){c(t.$$.fragment,n),c(r.$$.fragment,n),c(e.$$.fragment,n);for(let o=0;o<M.length;o+=1)c(l[o]);S=!0}},o(n){p(t.$$.fragment,n),p(r.$$.fragment,n),p(e.$$.fragment,n);for(let o=0;o<l.length;o+=1)p(l[o]);S=!1},d(n){n&&(w(s),w(a),w(m),w(u)),h(t,n),h(r,n),h(e,n);for(let o=0;o<l.length;o+=1)l[o].d(n)}}}function he(i,t,s){const r=new fe(.1,.1,.2,32).translate(0,.1,0),a=[];let e;const f=()=>{if(!e.visible)return;const $=new ie({color:16777215*Math.random()}),u=new le(r,$);e.matrix.decompose(u.position,u.quaternion,u.scale),u.scale.y=Math.random()*2+1,a.push(u)};pe(($,u)=>{u?(s(0,e.visible=!0,e),e.matrix.copy($)):s(0,e.visible=!1,e)});const m=({ref:$})=>$.rotateX(-Math.PI/2);function l($){e=$,s(0,e)}return[e,a,f,m,l]}class be extends F{constructor(t){super(),P(this,t,he,de,B,{})}}function ye(i){let t,s;return t=new be({}),{c(){_(t.$$.fragment)},l(r){g(t.$$.fragment,r)},m(r,a){d(t,r,a),s=!0},i(r){s||(c(t.$$.fragment,r),s=!0)},o(r){p(t.$$.fragment,r),s=!1},d(r){h(t,r)}}}function we(i){let t,s,r,a;return t=new ne({props:{$$slots:{default:[ye]},$$scope:{ctx:i}}}),r=new ce({}),{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment)},l(e){g(t.$$.fragment,e),s=k(e),g(r.$$.fragment,e)},m(e,f){d(t,e,f),y(e,s,f),d(r,e,f),a=!0},p(e,[f]){const m={};f&1&&(m.$$scope={dirty:f,ctx:e}),t.$set(m)},i(e){a||(c(t.$$.fragment,e),c(r.$$.fragment,e),a=!0)},o(e){p(t.$$.fragment,e),p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(t,e),h(r,e)}}}class He extends F{constructor(t){super(),P(this,t,null,we,B,{})}}export{He as component};
