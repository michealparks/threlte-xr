import{s as B,B as T,C as G,D as E,E as I,F as L,p as N,a as v,e as C,c as k,i as y,G as U,d as w,y as O}from"../chunks/scheduler.85ec70e4.js";import{S as F,i as P,b as _,d as g,m as d,a as c,t as p,e as h,f as z,g as J,c as K}from"../chunks/index.b6a8cb19.js";import{B as Q,g as V,a as W,u as Y,M as Z,s as ee,b as te,X as re,T as x,C as ne,H as se,c as ae,d as oe,e as fe}from"../chunks/xr.c491b383.js";import{e as X,u as ie,o as le}from"../chunks/each.58a2c473.js";import{C as me}from"../chunks/controllers.f683f103.js";function ue(i){let t,s;const r=[i[0],{mode:"immersive-ar"},{sessionInit:{domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]}}];let a={};for(let e=0;e<r.length;e+=1)a=T(a,r[e]);return t=new Q({props:a}),t.$on("click",i[1]),t.$on("error",i[2]),{c(){_(t.$$.fragment)},l(e){g(t.$$.fragment,e)},m(e,o){d(t,e,o),s=!0},p(e,[o]){const l=o&1?V(r,[o&1&&W(e[0]),r[1],o&0&&{sessionInit:{domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]}}]):{};t.$set(l)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){h(t,e)}}}function $e(i,t,s){const r=[];let a=G(t,r);function e(l){I.call(this,i,l)}function o(l){I.call(this,i,l)}return i.$$set=l=>{t=T(T({},t),E(l)),s(0,a=G(t,r))},[a,e,o]}class ce extends F{constructor(t){super(),P(this,t,$e,ue,B,{})}}const pe=i=>{const{xr:t}=Y().renderer,s=new Z;let r;const a=ee.subscribe(async l=>{var u;if(l===void 0){r=void 0,o();return}const m=await l.requestReferenceSpace("viewer");r=await((u=l.requestHitTestSource)==null?void 0:u.call(l,{space:m})),e()}),{start:e,stop:o}=te(()=>{if(r===void 0)return;const[l]=t.getFrame().getHitTestResults(r);if(l===void 0)return;const m=t.getReferenceSpace();if(m===null)return;const u=l.getPose(m);u!==void 0&&(s.fromArray(u.transform.matrix),i(s,l))},{autostart:!1});L(()=>{o(),a()})};function A(i,t,s){const r=i.slice();return r[6]=t[s],r[8]=s,r}function _e(i){let t,s,r,a;return t=new me({}),t.$on("select",i[2]),r=new se({}),r.$on("pinchend",i[2]),{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment)},l(e){g(t.$$.fragment,e),s=k(e),g(r.$$.fragment,e)},m(e,o){d(t,e,o),y(e,s,o),d(r,e,o),a=!0},p:O,i(e){a||(c(t.$$.fragment,e),c(r.$$.fragment,e),a=!0)},o(e){p(t.$$.fragment,e),p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(t,e),h(r,e)}}}function ge(i){let t,s,r,a;return t=new x.RingGeometry({props:{args:[.15,.2,32]}}),t.$on("create",i[3]),r=new x.MeshBasicMaterial({}),{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment)},l(e){g(t.$$.fragment,e),s=k(e),g(r.$$.fragment,e)},m(e,o){d(t,e,o),y(e,s,o),d(r,e,o),a=!0},p:O,i(e){a||(c(t.$$.fragment,e),c(r.$$.fragment,e),a=!0)},o(e){p(t.$$.fragment,e),p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(t,e),h(r,e)}}}function D(i,t){let s,r,a;return r=new x({props:{is:t[6]}}),{key:i,first:null,c(){s=C(),_(r.$$.fragment),this.h()},l(e){s=C(),g(r.$$.fragment,e),this.h()},h(){this.first=s},m(e,o){y(e,s,o),d(r,e,o),a=!0},p(e,o){t=e},i(e){a||(c(r.$$.fragment,e),a=!0)},o(e){p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(r,e)}}}function de(i){let t,s,r,a,e,o,l,m=[],u=new Map,$,S;t=new re({props:{foveation:1,$$slots:{default:[_e]},$$scope:{ctx:i}}}),r=new x.HemisphereLight({props:{args:[16777215,12303359,1],position:[.5,1,.25]}});function j(n){i[4](n)}let q={matrixAutoUpdate:!1,visible:!1,$$slots:{default:[ge]},$$scope:{ctx:i}};i[0]!==void 0&&(q.ref=i[0]),e=new x.Mesh({props:q}),N.push(()=>z(e,"ref",j));let M=X(i[1]);const R=n=>n[8];for(let n=0;n<M.length;n+=1){let f=A(i,M,n),b=R(f);u.set(b,m[n]=D(b,f))}return{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment),a=v(),_(e.$$.fragment),l=v();for(let n=0;n<m.length;n+=1)m[n].c();$=C()},l(n){g(t.$$.fragment,n),s=k(n),g(r.$$.fragment,n),a=k(n),g(e.$$.fragment,n),l=k(n);for(let f=0;f<m.length;f+=1)m[f].l(n);$=C()},m(n,f){d(t,n,f),y(n,s,f),d(r,n,f),y(n,a,f),d(e,n,f),y(n,l,f);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(n,f);y(n,$,f),S=!0},p(n,[f]){const b={};f&512&&(b.$$scope={dirty:f,ctx:n}),t.$set(b);const H={};f&512&&(H.$$scope={dirty:f,ctx:n}),!o&&f&1&&(o=!0,H.ref=n[0],U(()=>o=!1)),e.$set(H),f&2&&(M=X(n[1]),J(),m=ie(m,f,R,1,n,M,u,$.parentNode,le,D,$,A),K())},i(n){if(!S){c(t.$$.fragment,n),c(r.$$.fragment,n),c(e.$$.fragment,n);for(let f=0;f<M.length;f+=1)c(m[f]);S=!0}},o(n){p(t.$$.fragment,n),p(r.$$.fragment,n),p(e.$$.fragment,n);for(let f=0;f<m.length;f+=1)p(m[f]);S=!1},d(n){n&&(w(s),w(a),w(l),w($)),h(t,n),h(r,n),h(e,n);for(let f=0;f<m.length;f+=1)m[f].d(n)}}}function he(i,t,s){const r=new ne(.1,.1,.2,32).translate(0,.1,0),a=[];let e;const o=()=>{if(!e.visible)return;const u=new ae({color:16777215*Math.random()}),$=new oe(r,u);e.matrix.decompose($.position,$.quaternion,$.scale),$.scale.y=Math.random()*2+1,a.push($)};pe((u,$)=>{$?(s(0,e.visible=!0,e),e.matrix.copy(u)):s(0,e.visible=!1,e)});const l=({ref:u})=>u.rotateX(-Math.PI/2);function m(u){e=u,s(0,e)}return[e,a,o,l,m]}class be extends F{constructor(t){super(),P(this,t,he,de,B,{})}}function ye(i){let t,s;return t=new be({}),{c(){_(t.$$.fragment)},l(r){g(t.$$.fragment,r)},m(r,a){d(t,r,a),s=!0},i(r){s||(c(t.$$.fragment,r),s=!0)},o(r){p(t.$$.fragment,r),s=!1},d(r){h(t,r)}}}function we(i){let t,s,r,a;return t=new fe({props:{$$slots:{default:[ye]},$$scope:{ctx:i}}}),r=new ce({}),{c(){_(t.$$.fragment),s=v(),_(r.$$.fragment)},l(e){g(t.$$.fragment,e),s=k(e),g(r.$$.fragment,e)},m(e,o){d(t,e,o),y(e,s,o),d(r,e,o),a=!0},p(e,[o]){const l={};o&1&&(l.$$scope={dirty:o,ctx:e}),t.$set(l)},i(e){a||(c(t.$$.fragment,e),c(r.$$.fragment,e),a=!0)},o(e){p(t.$$.fragment,e),p(r.$$.fragment,e),a=!1},d(e){e&&w(s),h(t,e),h(r,e)}}}class Ce extends F{constructor(t){super(),P(this,t,null,we,B,{})}}export{Ce as component};
