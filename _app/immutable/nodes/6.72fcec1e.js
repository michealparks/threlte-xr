import{F as se,s as M,B as P,C as E,z as ee,D as fe,r as le,a as v,e as I,c as B,i as y,u as oe,v as $e,w as ue,d as k,p as me,G as ce,y as W,H as ge}from"../chunks/scheduler.92454ee1.js";import{S as J,i as X,b as g,d as p,m as _,a as u,t as c,e as d,g as A,c as F,f as pe}from"../chunks/index.e18f9c40.js";import{h as _e,i as de,T as j,g as he,a as be,b as te,X as ye,H as ke,e as we}from"../chunks/xr.862aa1eb.js";import{B as xe}from"../chunks/button-vr.c973bab3.js";import{c as ve,V as D,G as Be,R as ne,C as re,I as je,a as Ie,u as Te,b as Ce,W as He,D as Re}from"../chunks/code-link.ca0c990c.js";import{e as V,u as Se,o as Ge}from"../chunks/each.258ac6aa.js";import"../chunks/PositionMesh.be1d2dce.js";const Me=(f,n,a)=>{const t=de(f);let s;const e=()=>{var i;const r=(i=t.current)==null?void 0:i.hand.joints[n];if((r==null?void 0:r.jointRadius)===void 0){s=setTimeout(e,100);return}a(r)};return e(),()=>clearTimeout(s)},Je=(f,n)=>{const a=_e(void 0),t=Me(f,n,s=>a.set(s));return se(()=>t()),a},Xe=(f,n)=>(console.warn("useXRHandJoint is deprecated, use useHandJoint."),Je(f,n)),ze=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],De=f=>({ref:f&16384}),K=f=>({ref:f[14]});function O(f){let n,a;return n=new j.Mesh({props:{$$slots:{default:[Pe]},$$scope:{ctx:f}}}),{c(){g(n.$$.fragment)},l(t){p(n.$$.fragment,t)},m(t,s){_(n,t,s),a=!0},p(t,s){const e={};s&513&&(e.$$scope={dirty:s,ctx:t}),n.$set(e)},i(t){a||(u(n.$$.fragment,t),a=!0)},o(t){c(n.$$.fragment,t),a=!1},d(t){d(n,t)}}}function Pe(f){let n,a,t,s;return n=new j.SphereGeometry({props:{args:[f[0]]}}),t=new j.MeshBasicMaterial({props:{wireframe:!0,transparent:!0,opacity:.25}}),{c(){g(n.$$.fragment),a=v(),g(t.$$.fragment)},l(e){p(n.$$.fragment,e),a=B(e),p(t.$$.fragment,e)},m(e,r){_(n,e,r),y(e,a,r),_(t,e,r),s=!0},p(e,r){const i={};r&1&&(i.args=[e[0]]),n.$set(i)},i(e){s||(u(n.$$.fragment,e),u(t.$$.fragment,e),s=!0)},o(e){c(n.$$.fragment,e),c(t.$$.fragment,e),s=!1},d(e){e&&k(a),d(n,e),d(t,e)}}}function Ve(f){let n,a,t;const s=f[8].default,e=le(s,f,f[9],K);let r=f[1]&&O(f);return{c(){e&&e.c(),n=v(),r&&r.c(),a=I()},l(i){e&&e.l(i),n=B(i),r&&r.l(i),a=I()},m(i,$){e&&e.m(i,$),y(i,n,$),r&&r.m(i,$),y(i,a,$),t=!0},p(i,$){e&&e.p&&(!t||$&16896)&&oe(e,s,i,i[9],t?ue(s,i[9],$,De):$e(i[9]),K),i[1]?r?(r.p(i,$),$&2&&u(r,1)):(r=O(i),r.c(),u(r,1),r.m(a.parentNode,a)):r&&(A(),c(r,1,1,()=>{r=null}),F())},i(i){t||(u(e,i),u(r),t=!0)},o(i){c(e,i),c(r),t=!1},d(i){i&&(k(n),k(a)),e&&e.d(i),r&&r.d(i)}}}function Ne(f){let n,a;const t=[{is:f[3]},f[4]];let s={$$slots:{default:[Ve,({ref:e})=>({14:e}),({ref:e})=>e?16384:0]},$$scope:{ctx:f}};for(let e=0;e<t.length;e+=1)s=P(s,t[e]);return n=new j({props:s}),{c(){g(n.$$.fragment)},l(e){p(n.$$.fragment,e)},m(e,r){_(n,e,r),a=!0},p(e,[r]){const i=r&24?he(t,[r&8&&{is:e[3]},r&16&&be(e[4])]):{};r&16899&&(i.$$scope={dirty:r,ctx:e}),n.$set(i)},i(e){a||(u(n.$$.fragment,e),a=!0)},o(e){c(n.$$.fragment,e),a=!1},d(e){d(n,e)}}}function We(f,n,a){const t=["strength","range","gravityType","gravitationalConstant"];let s=E(n,t),e,{$$slots:r={},$$scope:i}=n,{strength:$=1}=n,{range:h=50}=n,{gravityType:w="static"}=n,{gravitationalConstant:o=6673e-14}=n;const{world:m,debug:l}=ve();ee(f,l,b=>a(1,e=b));const x=new D;let R=new Be;const ae={static:(b,T,S,C,G)=>b,linear:(b,T,S,C,G)=>b*(C/S),newtonian:(b,T,S,C,G)=>G*b*T/Math.pow(C,2)};function ie(){const b=new D;R.getWorldPosition(x),m.forEachRigidBody(T=>{const{x:S,y:C,z:G}=T.translation(),L=new D(S,C,G),q=x.distanceTo(L);if(q<h){let z=ae[w]($,T.mass(),h,q,o);z=z===1/0?$:z,b.subVectors(x,L).normalize().multiplyScalar(z),T.applyImpulse(b,!0)}})}return te(()=>{ie()}),f.$$set=b=>{n=P(P({},n),fe(b)),a(4,s=E(n,t)),"strength"in b&&a(5,$=b.strength),"range"in b&&a(0,h=b.range),"gravityType"in b&&a(6,w=b.gravityType),"gravitationalConstant"in b&&a(7,o=b.gravitationalConstant),"$$scope"in b&&a(9,i=b.$$scope)},[h,e,l,R,s,$,w,o,r,i]}class Ae extends J{constructor(n){super(),X(this,n,We,Ne,M,{strength:5,range:0,gravityType:6,gravitationalConstant:7})}}function Fe(f){let n,a;return n=new re({props:{shape:"ball",args:[f[1]]}}),{c(){g(n.$$.fragment)},l(t){p(n.$$.fragment,t)},m(t,s){_(n,t,s),a=!0},p(t,s){const e={};s&2&&(e.args=[t[1]]),n.$set(e)},i(t){a||(u(n.$$.fragment,t),a=!0)},o(t){c(n.$$.fragment,t),a=!1},d(t){d(n,t)}}}function Le(f){let n,a,t;function s(r){f[4](r)}let e={type:"kinematicPosition",$$slots:{default:[Fe]},$$scope:{ctx:f}};return f[0]!==void 0&&(e.rigidBody=f[0]),n=new ne({props:e}),me.push(()=>pe(n,"rigidBody",s)),{c(){g(n.$$.fragment)},l(r){p(n.$$.fragment,r)},m(r,i){_(n,r,i),t=!0},p(r,[i]){const $={};i&66&&($.$$scope={dirty:i,ctx:r}),!a&&i&1&&(a=!0,$.rigidBody=r[0],ce(()=>a=!1)),n.$set($)},i(r){t||(u(n.$$.fragment,r),t=!0)},o(r){c(n.$$.fragment,r),t=!1},d(r){d(n,r)}}}function qe(f,n,a){var h;let t,{jointIndex:s}=n,{hand:e}=n,r;const i=Xe(e,ze[s]);te(()=>{if(i.current===void 0||r===void 0)return;const{x:w,y:o,z:m}=i.current.position;r.setNextKinematicTranslation({x:w,y:o,z:m})});function $(w){r=w,a(0,r)}return f.$$set=w=>{"jointIndex"in w&&a(2,s=w.jointIndex),"hand"in w&&a(3,e=w.hand)},a(1,t=((h=i.current)==null?void 0:h.jointRadius)??1e-4),[r,t,s,e,$]}class Q extends J{constructor(n){super(),X(this,n,qe,Le,M,{jointIndex:2,hand:3})}}function U(f,n,a){const t=f.slice();return t[0]=n[a],t[2]=a,t}function Ee(f){let n,a,t,s,e;return n=new re({props:{shape:"cuboid",args:[H/2,H/2,H/2]}}),t=new Ie({props:{color:"hotpink"}}),{c(){g(n.$$.fragment),a=v(),g(t.$$.fragment),s=v()},l(r){p(n.$$.fragment,r),a=B(r),p(t.$$.fragment,r),s=B(r)},m(r,i){_(n,r,i),y(r,a,i),_(t,r,i),y(r,s,i),e=!0},p:W,i(r){e||(u(n.$$.fragment,r),u(t.$$.fragment,r),e=!0)},o(r){c(n.$$.fragment,r),c(t.$$.fragment,r),e=!1},d(r){r&&(k(a),k(s)),d(n,r),d(t,r)}}}function Y(f,n){let a,t,s;return t=new ne({props:{$$slots:{default:[Ee]},$$scope:{ctx:n}}}),{key:f,first:null,c(){a=I(),g(t.$$.fragment),this.h()},l(e){a=I(),p(t.$$.fragment,e),this.h()},h(){this.first=a},m(e,r){y(e,a,r),_(t,e,r),s=!0},p(e,r){n=e;const i={};r&8&&(i.$$scope={dirty:r,ctx:n}),t.$set(i)},i(e){s||(u(t.$$.fragment,e),s=!0)},o(e){c(t.$$.fragment,e),s=!1},d(e){e&&k(a),d(t,e)}}}function Ke(f){let n,a,t,s,e=[],r=new Map,i,$;n=new j.BoxGeometry({props:{args:[H,H,H]}}),t=new j.MeshStandardMaterial({props:{roughness:0,metalness:.2}});let h=V({length:N});const w=o=>o[2];for(let o=0;o<h.length;o+=1){let m=U(f,h,o),l=w(m);r.set(l,e[o]=Y(l,m))}return{c(){g(n.$$.fragment),a=v(),g(t.$$.fragment),s=v();for(let o=0;o<e.length;o+=1)e[o].c();i=I()},l(o){p(n.$$.fragment,o),a=B(o),p(t.$$.fragment,o),s=B(o);for(let m=0;m<e.length;m+=1)e[m].l(o);i=I()},m(o,m){_(n,o,m),y(o,a,m),_(t,o,m),y(o,s,m);for(let l=0;l<e.length;l+=1)e[l]&&e[l].m(o,m);y(o,i,m),$=!0},p(o,m){m&0&&(h=V({length:N}),A(),e=Se(e,m,w,1,o,h,r,i.parentNode,Ge,Y,i,U),F())},i(o){if(!$){u(n.$$.fragment,o),u(t.$$.fragment,o);for(let m=0;m<h.length;m+=1)u(e[m]);$=!0}},o(o){c(n.$$.fragment,o),c(t.$$.fragment,o);for(let m=0;m<e.length;m+=1)c(e[m]);$=!1},d(o){o&&(k(a),k(s),k(i)),d(n,o),d(t,o);for(let m=0;m<e.length;m+=1)e[m].d(o)}}}function Oe(f){let n,a;return n=new je({props:{limit:N,$$slots:{default:[Ke]},$$scope:{ctx:f}}}),{c(){g(n.$$.fragment)},l(t){p(n.$$.fragment,t)},m(t,s){_(n,t,s),a=!0},p(t,s){const e={};s&8&&(e.$$scope={dirty:s,ctx:t}),n.$set(e)},i(t){a||(u(n.$$.fragment,t),a=!0)},o(t){c(n.$$.fragment,t),a=!1},d(t){d(n,t)}}}function Qe(f){let n,a;return n=new j.Group({props:{position:[0,1.7,0],$$slots:{default:[Oe]},$$scope:{ctx:f}}}),{c(){g(n.$$.fragment)},l(t){p(n.$$.fragment,t)},m(t,s){_(n,t,s),a=!0},p(t,[s]){const e={};s&8&&(e.$$scope={dirty:s,ctx:t}),n.$set(e)},i(t){a||(u(n.$$.fragment,t),a=!0)},o(t){c(n.$$.fragment,t),a=!1},d(t){d(n,t)}}}const H=.02,N=100;class Ue extends J{constructor(n){super(),X(this,n,null,Qe,M,{})}}function Ye(f,n,a){const t=f.slice();return t[2]=n[a],t[4]=a,t}function Z(f){let n,a,t=V({length:25}),s=[];for(let e=0;e<t.length;e+=1)s[e]=Ze(Ye(f,t,e));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();n=I()},l(e){for(let r=0;r<s.length;r+=1)s[r].l(e);n=I()},m(e,r){for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,r);y(e,n,r),a=!0},i(e){if(!a){for(let r=0;r<t.length;r+=1)u(s[r]);a=!0}},o(e){s=s.filter(Boolean);for(let r=0;r<s.length;r+=1)c(s[r]);a=!1},d(e){e&&k(n),ge(s,e)}}}function Ze(f){let n,a,t,s;return n=new Q({props:{jointIndex:f[4],hand:"left"}}),t=new Q({props:{jointIndex:f[4],hand:"right"}}),{c(){g(n.$$.fragment),a=v(),g(t.$$.fragment)},l(e){p(n.$$.fragment,e),a=B(e),p(t.$$.fragment,e)},m(e,r){_(n,e,r),y(e,a,r),_(t,e,r),s=!0},p:W,i(e){s||(u(n.$$.fragment,e),u(t.$$.fragment,e),s=!0)},o(e){c(n.$$.fragment,e),c(t.$$.fragment,e),s=!1},d(e){e&&k(a),d(n,e),d(t,e)}}}function et(f){let n,a,t,s;n=new ke({});let e=f[0]&&Z(f);return{c(){g(n.$$.fragment),a=v(),e&&e.c(),t=I()},l(r){p(n.$$.fragment,r),a=B(r),e&&e.l(r),t=I()},m(r,i){_(n,r,i),y(r,a,i),e&&e.m(r,i),y(r,t,i),s=!0},p(r,i){r[0]?e?i&1&&u(e,1):(e=Z(r),e.c(),u(e,1),e.m(t.parentNode,t)):e&&(A(),c(e,1,1,()=>{e=null}),F())},i(r){s||(u(n.$$.fragment,r),u(e),s=!0)},o(r){c(n.$$.fragment,r),c(e),s=!1},d(r){r&&(k(a),k(t)),d(n,r),e&&e.d(r)}}}function tt(f){let n,a,t,s,e,r,i,$,h,w,o,m;return n=new ye({props:{$$slots:{default:[et]},$$scope:{ctx:f}}}),t=new Ue({}),e=new j.PerspectiveCamera({props:{makeDefault:!0,position:[0,1.8,1]}}),e.$on("create",nt),i=new j.AmbientLight({props:{intensity:.5}}),h=new j.SpotLight({props:{position:[1,8,1],angle:.3,penumbra:1,intensity:1,castShadow:!0}}),o=new Ae({props:{range:50,strength:1e-6,position:[0,1.7,0]}}),{c(){g(n.$$.fragment),a=v(),g(t.$$.fragment),s=v(),g(e.$$.fragment),r=v(),g(i.$$.fragment),$=v(),g(h.$$.fragment),w=v(),g(o.$$.fragment)},l(l){p(n.$$.fragment,l),a=B(l),p(t.$$.fragment,l),s=B(l),p(e.$$.fragment,l),r=B(l),p(i.$$.fragment,l),$=B(l),p(h.$$.fragment,l),w=B(l),p(o.$$.fragment,l)},m(l,x){_(n,l,x),y(l,a,x),_(t,l,x),y(l,s,x),_(e,l,x),y(l,r,x),_(i,l,x),y(l,$,x),_(h,l,x),y(l,w,x),_(o,l,x),m=!0},p(l,[x]){const R={};x&33&&(R.$$scope={dirty:x,ctx:l}),n.$set(R)},i(l){m||(u(n.$$.fragment,l),u(t.$$.fragment,l),u(e.$$.fragment,l),u(i.$$.fragment,l),u(h.$$.fragment,l),u(o.$$.fragment,l),m=!0)},o(l){c(n.$$.fragment,l),c(t.$$.fragment,l),c(e.$$.fragment,l),c(i.$$.fragment,l),c(h.$$.fragment,l),c(o.$$.fragment,l),m=!1},d(l){l&&(k(a),k(s),k(r),k($),k(w)),d(n,l),d(t,l),d(e,l),d(i,l),d(h,l),d(o,l)}}}const nt=({ref:f})=>f.lookAt(0,1.8,0);function rt(f,n,a){let t;const{isHandTracking:s}=Te();return ee(f,s,e=>a(0,t=e)),[t,s]}class at extends J{constructor(n){super(),X(this,n,rt,tt,M,{})}}function it(f){let n,a;return n=new Re({}),{c(){g(n.$$.fragment)},l(t){p(n.$$.fragment,t)},m(t,s){_(n,t,s),a=!0},i(t){a||(u(n.$$.fragment,t),a=!0)},o(t){c(n.$$.fragment,t),a=!1},d(t){d(n,t)}}}function st(f){let n=localStorage.getItem("debug"),a,t,s,e=n&&it();return t=new at({}),{c(){e&&e.c(),a=v(),g(t.$$.fragment)},l(r){e&&e.l(r),a=B(r),p(t.$$.fragment,r)},m(r,i){e&&e.m(r,i),y(r,a,i),_(t,r,i),s=!0},p:W,i(r){s||(u(e),u(t.$$.fragment,r),s=!0)},o(r){c(e),c(t.$$.fragment,r),s=!1},d(r){r&&k(a),e&&e.d(r),d(t,r)}}}function ft(f){let n,a;return n=new He({props:{gravity:[0,0,0],$$slots:{default:[st]},$$scope:{ctx:f}}}),{c(){g(n.$$.fragment)},l(t){p(n.$$.fragment,t)},m(t,s){_(n,t,s),a=!0},p(t,s){const e={};s&1&&(e.$$scope={dirty:s,ctx:t}),n.$set(e)},i(t){a||(u(n.$$.fragment,t),a=!0)},o(t){c(n.$$.fragment,t),a=!1},d(t){d(n,t)}}}function lt(f){let n,a,t,s,e,r;return n=new we({props:{$$slots:{default:[ft]},$$scope:{ctx:f}}}),t=new Ce({props:{href:"https://github.com/michealparks/threlte-xr/tree/main/src/routes/hand-physics"}}),e=new xe({}),{c(){g(n.$$.fragment),a=v(),g(t.$$.fragment),s=v(),g(e.$$.fragment)},l(i){p(n.$$.fragment,i),a=B(i),p(t.$$.fragment,i),s=B(i),p(e.$$.fragment,i)},m(i,$){_(n,i,$),y(i,a,$),_(t,i,$),y(i,s,$),_(e,i,$),r=!0},p(i,[$]){const h={};$&1&&(h.$$scope={dirty:$,ctx:i}),n.$set(h)},i(i){r||(u(n.$$.fragment,i),u(t.$$.fragment,i),u(e.$$.fragment,i),r=!0)},o(i){c(n.$$.fragment,i),c(t.$$.fragment,i),c(e.$$.fragment,i),r=!1},d(i){i&&(k(a),k(s)),d(n,i),d(t,i),d(e,i)}}}class _t extends J{constructor(n){super(),X(this,n,null,lt,M,{})}}export{_t as component};
